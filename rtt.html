<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vieus Sport - Live Sports Streaming</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Base Styles and Variables */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
:root{
--primary:#1a1a2e;
--secondary:#16213e;
--accent:#0f3460;
--highlight:#e94560;
--text:#f1f1f1;
--text-secondary:#b8b8b8;
--upcoming:#4CAF50;
--live-indicator:#ff4757;
--scheduled-bg:#f5f5f5;
--scheduled-text:#333;
--scheduled-secondary:#666;
}
body{background-color:var(--primary);color:var(--text);min-height:100vh;overflow-x:hidden;}
.container{max-width:1200px;margin:0 auto;padding:0 20px;}
/* Header Styles */
header{background-color:var(--secondary);padding:15px 0;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0, 0, 0, 0.3);}
.header-content{display:flex;justify-content:space-between;align-items:center;}
.logo{font-size:1.6rem;font-weight:700;color:white;}
.logo i{color:var(--highlight);margin-right:5px;}
.nav-links{display:none!important;}
.user-actions{display:flex;align-items:center;gap:15px;}
.search-box{display:flex;align-items:center;background:rgba(255, 255, 255, 0.1);border-radius:20px;padding:6px 15px;position:relative;}
.search-box input{background:transparent;border:none;color:var(--text);outline:none;width:150px;font-size:0.9rem;}
.search-box i{color:var(--text-secondary);margin-right:8px;}
/* Sport Tabs Styles */
.sport-tabs{display:flex;background:var(--accent);padding:15px 0;margin-bottom:20px;border-radius:12px;overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;}
.sport-tabs::-webkit-scrollbar{display:none;}
.sport-tab{flex:1;text-align:center;padding:10px 15px;cursor:pointer;transition:all 0.3s;border-radius:8px;margin:0 5px;white-space:nowrap;min-width:120px;}
.sport-tab i{display:block;font-size:1.5rem;margin-bottom:5px;}
.sport-tab span{font-size:0.9rem;font-weight:500;}
.sport-tab:hover{background:rgba(255, 255, 255, 0.1);}
.sport-tab.active{background:var(--highlight);color:white;font-weight:600;}
/* Simplified Buttons */
.btn-icon{background:none;border:none;color:var(--text);font-size:1.2rem;padding:5px;cursor:pointer;transition:color 0.3s;position:relative;}
.btn-primary{padding:8px 15px;border-radius:20px;background-color:var(--highlight);color:white;border:none;font-weight:600;cursor:pointer;transition:all 0.3s;}
/* Notification Badge */
.notification-badge{position:absolute;top:-5px;right:-5px;background:var(--highlight);color:white;border-radius:50%;width:18px;height:18px;font-size:0.7rem;display:flex;align-items:center;justify-content:center;font-weight:bold;}
/* --- HORIZONTAL SPORT TABS --- */
.mobile-tabs-bar{background:var(--accent);overflow-x:auto;white-space:nowrap;padding:10px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none;display:none;box-shadow:0 2px 8px rgba(0, 0, 0, 0.2) inset;}
.mobile-tabs-bar::-webkit-scrollbar{display:none;}
.mobile-tabs-content{display:inline-flex;gap:15px;padding:0 20px;}
.sport-tab-inline{display:inline-flex;align-items:center;padding:8px 15px;border-radius:20px;background:var(--secondary);color:var(--text);font-size:0.9rem;font-weight:500;cursor:pointer;transition:background 0.3s, transform 0.2s;}
.sport-tab-inline i{margin-right:8px;}
.sport-tab-inline:hover{background:rgba(233, 69, 96, 0.1);color:var(--highlight);}
.sport-tab-inline.active{background:var(--highlight);color:white;font-weight:600;}
/* --- MAIN CONTENT & LAYOUT --- */
.main-content{display:grid;grid-template-columns:1fr;gap:30px;padding:30px 20px;}
/* --- HERO CAROUSEL --- */
.hero-carousel-section{position:relative;width:100%;height:300px;margin-bottom:30px;border-radius:12px;overflow:hidden;box-shadow:0 5px 20px rgba(0, 0, 0, 0.5);transition:background-image 0.5s ease-in-out;}
.hero-carousel-container{display:flex;height:100%;}
.hero-card{min-width:100%;height:100%;background-size:cover;background-position:center;border-radius:12px;padding:40px;display:flex;flex-direction:column;justify-content:center;color:white;position:relative;}
.hero-card::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(to right, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.7));z-index:1;}
.hero-content{position:relative;z-index:2;text-align:left;max-width:700px;}
.hero-title{font-size:2.5rem;margin-bottom:5px;font-weight:700;line-height:1.2;}
.hero-league-info{display:flex;align-items:center;margin-bottom:10px;}
.hero-league-logo{width:30px;height:30px;border-radius:50%;margin-right:10px;border:2px solid white;}
.hero-league-name{font-size:1.1rem;font-weight:600;color:var(--highlight);}
/* --- Match Card Styles --- */
.matches-grid{display:grid;grid-template-columns:repeat(2, 1fr);gap:25px;margin-bottom:40px;}
/* Section headers */
.football-section-header {
    font-size: 1.3rem;
    margin: 25px 0 15px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--accent);
    color: var(--highlight);
    display: flex;
    align-items: center;
    gap: 10px;
}
.football-section-header i {
    font-size: 1.1rem;
}
/* Light gray background for scheduled matches */
.scheduled-match .match-card {
    background: var(--scheduled-bg) !important;
}

.scheduled-match .match-card::before {
    background: linear-gradient(135deg, rgba(245, 245, 245, 0.9) 0%, rgba(230, 230, 230, 0.95) 100%) !important;
}

.scheduled-match .match-info h3 {
    color: var(--scheduled-text) !important;
}

.scheduled-match .match-info p {
    color: var(--scheduled-secondary) !important;
}

.scheduled-match .match-info p:nth-of-type(1) {
    color: var(--highlight) !important;
}
/* Media query for mobile */
@media (max-width: 768px){
.matches-grid{grid-template-columns:1fr;}
.mobile-tabs-bar{display:block;}
.sport-tabs{display:none;}
}
/* Match card container */
.match-card-link{text-decoration:none;color:var(--text);display:block;cursor:pointer;transition:transform 0.3s ease, box-shadow 0.3s ease;}
.match-card-link:hover{transform:translateY(-8px);box-shadow:0 15px 30px rgba(0, 0, 0, 0.5), 0 0 15px var(--highlight);}
.match-card{background:var(--secondary);border-radius:12px;overflow:hidden;position:relative;padding:20px;box-shadow:0 5px 15px rgba(0, 0, 0, 0.3);height:100%;}
.match-card::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg, rgba(26, 26, 46, 0.8) 0%, rgba(22, 33, 62, 0.9) 100%);opacity:0.8;z-index:1;border-radius:12px;}
.match-info{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;text-align:center;}
.match-logo{width:60px;height:60px;margin-bottom:10px;border-radius:50%;overflow:hidden;border:3px solid var(--accent);box-shadow:0 0 10px rgba(0, 0, 0, 0.5);}
.match-logo img{width:100%;height:100%;object-fit:cover;}
.match-info h3{font-size:1.3rem;font-weight:700;line-height:1.2;margin-bottom:5px;color:white;}
.match-info p:nth-of-type(1){font-size:0.9rem;font-weight:500;color:var(--highlight);margin-top:0;}
.match-info p:nth-of-type(2){font-size:0.8rem;font-weight:300;color:var(--text-secondary);margin-bottom:20px;}
.stream-btn-visual{position:relative;z-index:2;display:block;width:80%;margin:10px auto 0;text-align:center;padding:8px 20px;border-radius:20px;border:none;color:white;font-weight:600;cursor:pointer;transition:all 0.3s;}
.match-card .stream-btn{display:none!important;}
/* --- FOOTER STYLES --- */
footer{background-color:var(--secondary);padding:40px 0 20px;border-top:1px solid var(--accent);}
.footer-content{display:flex;flex-wrap:wrap;gap:30px;margin-bottom:30px;justify-content:space-between;}
.footer-section{flex:1 1 200px;min-width:180px;}
.footer-section h4{font-size:1rem;color:var(--highlight);margin-bottom:15px;border-left:3px solid var(--highlight);padding-left:10px;font-weight:600;}
.footer-section ul{list-style:none;}
.footer-section ul li a{color:var(--text-secondary);text-decoration:none;font-size:0.9rem;line-height:1.8;transition:color 0.2s;}
.footer-section ul li a:hover{color:var(--text);}
/* Mobile Bottom Dock */
.mobile-bottom-dock{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--secondary);padding:10px 0;box-shadow:0 -2px 10px rgba(0, 0, 0, 0.3);z-index:1000;}
.dock-item{flex:1;text-align:center;color:var(--text-secondary);font-size:0.8rem;padding:5px 0;}
.dock-item.active{color:var(--highlight);}
.dock-item i{display:block;margin-bottom:3px;font-size:1.2rem;}
/* Search Results */
.search-results{position:absolute;top:100%;left:0;right:0;background:var(--secondary);border-radius:0 0 12px 12px;max-height:300px;overflow-y:auto;z-index:1000;box-shadow:0 5px 15px rgba(0, 0, 0, 0.5);display:none;}
.search-result-item{padding:10px 15px;border-bottom:1px solid rgba(255, 255, 255, 0.1);cursor:pointer;transition:background 0.2s;}
.search-result-item:hover{background:rgba(255, 255, 255, 0.05);}
.search-result-item:last-child{border-bottom:none;}
.search-result-item .match-name{font-weight:500;margin-bottom:3px;}
.search-result-item .match-league{font-size:0.8rem;color:var(--text-secondary);}
.search-result-item .match-sport{display:inline-block;background:var(--accent);color:var(--highlight);font-size:0.7rem;padding:2px 6px;border-radius:10px;margin-left:5px;}
/* Modal/Popup Styles */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0, 0, 0, 0.8);display:flex;align-items:center;justify-content:center;z-index:2000;opacity:0;visibility:hidden;transition:all 0.3s;}
.modal-overlay.active{opacity:1;visibility:visible;}
.modal-content{background:var(--secondary);border-radius:12px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto;padding:25px;position:relative;transform:translateY(20px);transition:transform 0.3s;}
.modal-overlay.active .modal-content{transform:translateY(0);}
.modal-close{position:absolute;top:15px;right:15px;background:none;border:none;color:var(--text-secondary);font-size:1.5rem;cursor:pointer;transition:color 0.2s;}
.modal-close:hover{color:var(--highlight);}
.modal-header{margin-bottom:20px;padding-right:30px;}
.modal-title{font-size:1.5rem;margin-bottom:5px;color:var(--highlight);}
.modal-league{font-size:1rem;color:var(--text-secondary);}
.modal-details{margin-bottom:25px;}
.modal-detail-item{display:flex;margin-bottom:10px;}
.modal-detail-label{width:120px;color:var(--text-secondary);font-weight:500;}
.modal-detail-value{flex:1;}
.modal-actions{display:flex;gap:10px;flex-wrap:wrap;}
.modal-btn{flex:1;padding:10px;border-radius:8px;border:none;font-weight:600;cursor:pointer;transition:all 0.2s;min-width:140px;}
.modal-btn-primary{background:var(--highlight);color:white;}
.modal-btn-secondary{background:var(--accent);color:white;}
.modal-btn:hover{transform:translateY(-2px);box-shadow:0 5px 10px rgba(0, 0, 0, 0.3);}
.modal-cross-references{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap;}
/* Notification Panel */
.notification-panel{position:fixed;top:0;right:-400px;width:380px;height:100vh;background:var(--secondary);box-shadow:-5px 0 15px rgba(0, 0, 0, 0.5);z-index:1500;transition:right 0.3s ease;padding:20px;overflow-y:auto;}
.notification-panel.active{right:0;}
.notification-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid rgba(255, 255, 255, 0.1);}
.notification-title{font-size:1.3rem;color:var(--highlight);}
.notification-close{background:none;border:none;color:var(--text-secondary);font-size:1.2rem;cursor:pointer;}
.notification-item{padding:15px;background:var(--primary);border-radius:8px;margin-bottom:10px;border-left:3px solid var(--highlight);}
.notification-match{font-weight:600;margin-bottom:5px;}
.notification-time{font-size:0.9rem;color:var(--text-secondary);}
.notification-actions{display:flex;gap:10px;margin-top:10px;}
.notification-btn{padding:5px 10px;border-radius:5px;border:none;font-size:0.8rem;cursor:pointer;}
.notification-btn.watch{background:var(--highlight);color:white;}
.notification-btn.remove{background:var(--accent);color:white;}
/* Toast Notification */
.toast-notification{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--highlight);color:white;padding:15px 25px;border-radius:8px;box-shadow:0 5px 15px rgba(0, 0, 0, 0.3);z-index:2000;transition:transform 0.3s ease;max-width:400px;text-align:center;}
.toast-notification.active{transform:translateX(-50%) translateY(0);}
.toast-match{font-weight:600;margin-bottom:5px;}
.toast-time{font-size:0.9rem;opacity:0.9;}
/* Responsive adjustments */
@media (max-width: 600px){
.footer-content{gap:20px;flex-direction:column;}
.footer-section{min-width:100%;}
.mobile-bottom-dock{display:flex;}
.modal-content{width:95%;padding:20px;}
.modal-actions{flex-direction:column;}
.notification-panel{width:100%;right:-100%;}
.modal-cross-references{flex-direction:column;}
}
@media (max-width: 1000px){
.main-content{grid-template-columns:1fr;}
}
@media (min-width: 769px){
.sport-tabs{display:flex;}
}
</style>
</head>
<body>
<header>
<div class="container">
<div class="header-content">
<div class="logo">
<i class="fas fa-play-circle"></i>
<span>Vieus Sport</span>
</div>
<div class="user-actions">
<div class="search-box">
<i class="fas fa-search"></i>
<input type="text" placeholder="Search..." id="searchInputDesktop">
<div class="search-results" id="searchResults"></div>
</div>
<button class="btn-icon" id="notificationBtn">
<i class="fas fa-bell"></i>
<span class="notification-badge" id="notificationBadge">0</span>
</button>
</div>
</div>
</div>
</header>

<div class="container">
<div class="sport-tabs" id="desktopSportTabs">
<div class="sport-tab active" data-sport="live">
<i class="fas fa-broadcast-tower"></i>
<span>Live</span>
</div>
<div class="sport-tab" data-sport="others">
<i class="fas fa-ellipsis-h"></i>
<span>Others</span>
</div>
</div>
</div>

<div class="mobile-tabs-bar" id="mobileTabsBar">
<div class="mobile-tabs-content">
<div class="sport-tab-inline active" data-sport="live">
<i class="fas fa-broadcast-tower"></i> Live
</div>
<div class="sport-tab-inline" data-sport="others">
<i class="fas fa-ellipsis-h"></i> Others
</div>
</div>
</div>

<div class="container">
<div class="main-content">
<div class="content-area">
<section class="hero-carousel-section">
<div class="hero-carousel-container" id="heroCarousel">
</div>
<div class="hero-carousel-dots" id="heroCarouselDots"></div>
</section>

<section class="featured-matches">
<h2 class="section-title" style="font-size: 1.5rem; margin-bottom: 20px;">
<i class="fas fa-fire"></i> <span id="sportTitle">Live</span> Matches
</h2>

<!-- Live Section -->
<div id="liveSection" style="display: block;">
<div class="football-section-header">
<i class="fas fa-broadcast-tower"></i> Live Matches
</div>
<div class="matches-grid" id="liveContainer">
</div>
</div>

<!-- Featured Matches Section -->
<div id="featuredSection" style="display: block;">
<div class="football-section-header">
<i class="fas fa-star"></i> Featured Matches
</div>
<div class="matches-grid" id="featuredContainer">
</div>
</div>

<!-- Upcoming Section -->
<div id="upcomingSection" style="display: block;">
<div class="football-section-header">
<i class="far fa-clock"></i> Upcoming Matches
</div>
<div class="matches-grid" id="upcomingContainer">
</div>
</div>

<!-- Others Section -->
<div id="othersSection" style="display: none;">
<div class="matches-grid" id="othersContainer">
</div>
</div>
</section>
</div>
</div>
</div>

<div class="mobile-bottom-dock">
<div class="dock-item active">
<i class="fas fa-home"></i> Home
</div>
<div class="dock-item">
<i class="fas fa-tv"></i> Live
</div>
<div class="dock-item">
<i class="fas fa-calendar-alt"></i> Schedule
</div>
<div class="dock-item">
<i class="fas fa-user-circle"></i> Account
</div>
</div>

<div class="notification-panel" id="notificationPanel">
<div class="notification-header">
<h3 class="notification-title">Your Reminders</h3>
<button class="notification-close" id="notificationPanelClose">
<i class="fas fa-times"></i>
</button>
</div>
<div class="notification-list" id="notificationList">
</div>
</div>

<div class="modal-overlay" id="matchModal">
<div class="modal-content">
<button class="modal-close" id="modalClose">&times;</button>
<div class="modal-header">
<h2 class="modal-title" id="modalMatchTitle">Match Title</h2>
<p class="modal-league" id="modalMatchLeague">League Name</p>
</div>
<div class="modal-details">
<div class="modal-detail-item">
<span class="modal-detail-label">Date & Time:</span>
<span class="modal-detail-value" id="modalMatchTime">Time Info</span>
</div>
<div class="modal-detail-item">
<span class="modal-detail-label">Venue:</span>
<span class="modal-detail-value" id="modalMatchVenue">Venue Info</span>
</div>
<div class="modal-detail-item">
<span class="modal-detail-label">Status:</span>
<span class="modal-detail-value" id="modalMatchStatus">Match Status</span>
</div>
<div class="modal-detail-item">
<span class="modal-detail-label">Broadcast:</span>
<span class="modal-detail-value" id="modalMatchBroadcast">Broadcast Info</span>
</div>
</div>
<div class="modal-actions">
<button class="modal-btn modal-btn-primary" id="modalWatchBtn">
<i class="fas fa-eye"></i> Watch Now
</button>
<button class="modal-btn modal-btn-secondary" id="modalReminderBtn">
<i class="far fa-bell"></i> Set Reminder
</button>
</div>
<div class="modal-cross-references" id="modalCrossReferences">
</div>
</div>
</div>

<div class="toast-notification" id="toastNotification">
<div class="toast-match" id="toastMatch">Match Starting Soon!</div>
<div class="toast-time" id="toastTime">Your reminder match is about to begin</div>
</div>

<footer>
<div class="container">
<div class="footer-content" id="footerLeagueLinks">
</div>
<p style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; padding: 20px 0;">&copy; 2023 Vieus Sport. All rights reserved.</p>
</div>
</footer>

<script>
// --- Configuration ---
const API_BASE_URL = 'http://127.0.0.1:5000/api';
const API_LIVE_FIXTURES = `${API_BASE_URL}/live_fixtures`;
const API_UPCOMING_FIXTURES = `${API_BASE_URL}/upcoming_fixtures`;
const API_HERO_BASE_URL = 'http://127.0.0.1:5000/api/hero-fixtures';

// Add request caching
let requestCache = {
    live_fixtures: { data: null, timestamp: 0 },
    upcoming_fixtures: { data: null, timestamp: 0 },
    hero_football: { data: null, timestamp: 0 },
    hero_others: { data: null, timestamp: 0 }
};

const CACHE_DURATION = 420000; // 7 minutes

// Cached fetch functions
async function fetchWithCache(url, cacheKey) {
    const now = Date.now();
    if (requestCache[cacheKey] && (now - requestCache[cacheKey].timestamp) < CACHE_DURATION) {
        console.log(`Using cached data for ${cacheKey}`);
        return requestCache[cacheKey].data;
    }
    
    try {
        console.log(`Fetching fresh data for ${cacheKey}`);
        const response = await fetch(url);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        requestCache[cacheKey] = {
            data: data.data || data,
            timestamp: now
        };
        return requestCache[cacheKey].data;
    } catch (error) {
        console.error(`Fetch failed for ${cacheKey}:`, error);
        return requestCache[cacheKey] ? requestCache[cacheKey].data : [];
    }
}

// Updated fetch functions
async function fetchLiveFixtures() {
    return await fetchWithCache(API_LIVE_FIXTURES, 'live_fixtures');
}

async function fetchUpcomingFixtures() {
    return await fetchWithCache(API_UPCOMING_FIXTURES, 'upcoming_fixtures');
}

async function fetchHeroFixtures(sport) {
    const cacheKey = sport === 'live' ? 'hero_football' : 'hero_others';
    return await fetchWithCache(`${API_HERO_BASE_URL}/${sport}`, cacheKey);
}

// Intelligent League Prioritization
const LEAGUE_PRIORITY = {
    // Champions League gets highest priority on match days
    'champions league': 100,
    'europa league': 90,
    'conference league': 85,
    
    // Major domestic leagues
    'premier league': 80,
    'laliga': 75,
    'bundesliga': 70,
    'serie a': 65,
    'ligue 1': 60,
    
    // Major tournaments
    'world cup': 95,
    'euro': 85,
    'copa libertadores': 70,
    
    // Other important competitions
    'fa cup': 55,
    'uefa nations league': 50,
    'eredivisie': 45,
    
    // Default priority for other leagues
    'default': 10
};

// Get current day to determine if it's Champions League day
function getCurrentDayPriority() {
    const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
    const isChampionsLeagueDay = today === 2 || today === 3; // Tuesday or Wednesday
    
    return {
        isChampionsLeagueDay,
        dayBonus: isChampionsLeagueDay ? 50 : 0 // Extra priority boost on CL days
    };
}

// Smart fixture sorting based on league importance and current day
function sortFixturesByPriority(fixtures) {
    const dayInfo = getCurrentDayPriority();
    
    return fixtures.sort((a, b) => {
        const leagueA = (a.league || '').toLowerCase();
        const leagueB = (b.league || '').toLowerCase();
        
        // Get priority scores
        const priorityA = LEAGUE_PRIORITY[leagueA] || LEAGUE_PRIORITY.default;
        const priorityB = LEAGUE_PRIORITY[leagueB] || LEAGUE_PRIORITY.default;
        
        // Apply day-based bonus (Champions League gets extra boost on match days)
        const finalPriorityA = priorityA + (leagueA.includes('champions') ? dayInfo.dayBonus : 0);
        const finalPriorityB = priorityB + (leagueB.includes('champions') ? dayInfo.dayBonus : 0);
        
        // Higher priority first
        return finalPriorityB - finalPriorityA;
    });
}

// Filter featured matches (top 6 most important upcoming matches)
function getFeaturedMatches(upcomingFixtures) {
    const sorted = sortFixturesByPriority(upcomingFixtures);
    return sorted.slice(0, 6); // Top 6 most important matches
}

// Sport configurations
const SPORT_BACKGROUNDS = {
    'live': 'url(https://images.unsplash.com/photo-1579952363873-27f3bade9f55?q=80&w=2500&h=300&fit=crop&crop=top&auto=format&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)', 
    'others': 'url(https://images.unsplash.com/photo-1456524314798-8c1d533519ec?q=80&w=2500&h=300&fit=crop&crop=top&auto=format&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)'
};

const SPORTS = {
    'live': { name: 'Live', icon: 'fas fa-broadcast-tower' },
    'others': { name: 'Other Sports', icon: 'fas fa-ellipsis-h' }
};

// Global variables
let currentSport = 'live';
let allFixtures = [];
let liveFixtures = [];
let upcomingFixtures = [];
let autoSlideInterval;
let fixtureIndexHistory = []; 
let currentModalFixture = null;
let userReminders = JSON.parse(localStorage.getItem('vieusReminders')) || [];
let notificationInterval;

// DOM elements
const desktopSportTabs = document.querySelectorAll('.sport-tab');
const inlineSportTabs = document.querySelectorAll('.sport-tab-inline');
const sportTitleElement = document.getElementById('sportTitle');
const footerLeagueLinks = document.getElementById('footerLeagueLinks');
const liveSection = document.getElementById('liveSection');
const featuredSection = document.getElementById('featuredSection');
const upcomingSection = document.getElementById('upcomingSection');
const othersSection = document.getElementById('othersSection');
const liveContainer = document.getElementById('liveContainer');
const featuredContainer = document.getElementById('featuredContainer');
const upcomingContainer = document.getElementById('upcomingContainer');
const othersContainer = document.getElementById('othersContainer');
const heroCarouselContainer = document.getElementById('heroCarousel');
const heroCarouselSection = document.querySelector('.hero-carousel-section');
const searchInput = document.getElementById('searchInputDesktop');
const searchResults = document.getElementById('searchResults');
const matchModal = document.getElementById('matchModal');
const modalClose = document.getElementById('modalClose');
const modalMatchTitle = document.getElementById('modalMatchTitle');
const modalMatchLeague = document.getElementById('modalMatchLeague');
const modalMatchTime = document.getElementById('modalMatchTime');
const modalMatchVenue = document.getElementById('modalMatchVenue');
const modalMatchStatus = document.getElementById('modalMatchStatus');
const modalMatchBroadcast = document.getElementById('modalMatchBroadcast');
const modalWatchBtn = document.getElementById('modalWatchBtn');
const modalReminderBtn = document.getElementById('modalReminderBtn');
const notificationBtn = document.getElementById('notificationBtn');
const notificationBadge = document.getElementById('notificationBadge');
const notificationPanel = document.getElementById('notificationPanel');
const notificationPanelClose = document.getElementById('notificationPanelClose');
const notificationList = document.getElementById('notificationList');
const toastNotification = document.getElementById('toastNotification');
const toastMatch = document.getElementById('toastMatch');
const toastTime = document.getElementById('toastTime');

// Utility Functions
function navigateToSchedule(matchContext) {
    const sport = matchContext?.sport || currentSport;
    const filter = matchContext?.filter || 'all';
    const league = matchContext?.league ? `&league=${encodeURIComponent(matchContext.league)}` : '';
    window.location.href = `schedule.html?sport=${sport}&filter=${filter}${league}`;
}

function getMatchStatus(fixture) {
    if (fixture.stream_url && fixture.stream_url !== 'N/A' && fixture.stream_url !== '#') {
        return 'live';
    } else if (fixture.status && fixture.status.toLowerCase().includes('finished')) {
        return 'finished';
    } else {
        return 'upcoming';
    }
}

function adjustTimezoneOffset(fixtures, offsetHours) {
    if (!fixtures || fixtures.length === 0) return [];

    return fixtures.map(fixture => {
        if (!fixture.time || !/^\d{2}:\d{2}$/.test(fixture.time)) {
            return fixture;
        }
        
        try {
            const now = new Date();
            const dateString = now.toISOString().split('T')[0];
            const dateTimeString = `${dateString}T${fixture.time}:00`;
            let fixtureDate = new Date(dateTimeString);

            if (isNaN(fixtureDate.getTime())) {
                return fixture;
            }

            fixtureDate.setHours(fixtureDate.getHours() + offsetHours);
            const adjustedTime = fixtureDate.toLocaleTimeString('en-GB', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });

            return {
                ...fixture,
                time: adjustedTime
            };
        } catch (e) {
            console.error('Error adjusting timezone offset:', e);
            return fixture;
        }
    });
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    setupEventListeners();
    switchSport(currentSport);
    updateNotificationBadge();
    renderNotificationList();
    startNotificationChecker();
});

function setupEventListeners() {
    // Sport tabs
    desktopSportTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const sport = this.getAttribute('data-sport');
            switchSport(sport);
            desktopSportTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
        });
    });

    inlineSportTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const sport = this.getAttribute('data-sport');
            switchSport(sport);
            inlineSportTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            desktopSportTabs.forEach(t => {
                t.classList.remove('active');
                if (t.getAttribute('data-sport') === sport) {
                    t.classList.add('active');
                }
            });
        });
    });

    // Search functionality
    searchInput.addEventListener('input', handleSearch);
    searchInput.addEventListener('focus', function() {
        if (searchInput.value.length > 0) {
            searchResults.style.display = 'block';
        }
    });

    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-box')) {
            searchResults.style.display = 'none';
        }
    });

    // Modal functionality
    modalClose.addEventListener('click', closeModal);
    matchModal.addEventListener('click', function(e) {
        if (e.target === matchModal) {
            closeModal();
        }
    });

    modalWatchBtn.addEventListener('click', function() {
        if (currentModalFixture && currentModalFixture.stream_url && 
            currentModalFixture.stream_url !== 'N/A' && currentModalFixture.stream_url !== '#') {
            window.open(currentModalFixture.stream_url, '_blank');
        } else {
            alert('No stream available for this match yet.');
        }
    });

    modalReminderBtn.addEventListener('click', function() {
        if (currentModalFixture) {
            setReminder(currentModalFixture);
        }
    });

    // Notification functionality
    notificationBtn.addEventListener('click', toggleNotificationPanel);
    notificationPanelClose.addEventListener('click', closeNotificationPanel);
}

// Section Visibility Management
function showLiveSections() {
    liveSection.style.display = 'block';
    featuredSection.style.display = 'block';
    upcomingSection.style.display = 'block';
    othersSection.style.display = 'none';
    sportTitleElement.textContent = 'Live';
}

function showOthersSection() {
    liveSection.style.display = 'none';
    featuredSection.style.display = 'none';
    upcomingSection.style.display = 'none';
    othersSection.style.display = 'block';
    sportTitleElement.textContent = 'Other Sports';
}

// Carousel Logic
function renderHeroCarousel(fixtures) {
    heroCarouselContainer.innerHTML = '';
    allFixtures = fixtures;

    const sportKey = currentSport || 'live';
    const backgroundUrl = SPORT_BACKGROUNDS[sportKey] || SPORT_BACKGROUNDS['live'];

    let fixtureToDisplay = fixtures.length > 0 ? fixtures[0] : null;

    heroCarouselContainer.innerHTML = `
        <div class="hero-card" id="dynamicHeroCard" style="background-image: ${backgroundUrl};">
        </div>
    `;

    const dynamicCard = document.getElementById('dynamicHeroCard');

    if (!fixtureToDisplay) {
        dynamicCard.innerHTML = `
            <div class="hero-content">
                <div class="hero-league-info">
                    <span class="hero-league-name">Upcoming Matches</span>
                </div>
                <h1 class="hero-title">No Events Available</h1>
                <p class="hero-subtitle">Check back soon for exciting upcoming ${SPORTS[currentSport].name} events.</p>
            </div>
        `;
        return;
    }

    const match = fixtureToDisplay;
    const leagueLogo = match.logo_url || 'https://via.placeholder.com/30/0f3460/ffffff?text=L';
    const leagueName = match.league || 'Unknown League';

    heroCarouselSection.style.backgroundImage = backgroundUrl;
    dynamicCard.innerHTML = `
        <div class="hero-content">
            <div class="hero-league-info">
                <img src="${leagueLogo}" alt="${leagueName} Logo" class="hero-league-logo" onerror="this.onerror=null; this.src='https://via.placeholder.com/30/0f3460/ffffff?text=L';">
                <span class="hero-league-name">${leagueName} - ${match.time}</span>
            </div>
            <h1 class="hero-title">${match.fixture}</h1>
            <p class="hero-subtitle">Highest Priority Match (${leagueName})</p>
            <button class="btn btn-primary hero-btn view-details-btn" data-fixture='${JSON.stringify(match).replace(/'/g, "&#39;")}'>
                <i class="fas fa-eye"></i> View Details
            </button>
        </div>
    `;

    document.querySelector('.view-details-btn').addEventListener('click', function() {
        const fixtureData = this.getAttribute('data-fixture');
        const fixture = JSON.parse(fixtureData.replace(/&#39;/g, "'"));
        openModal(fixture);
    });

    if (fixtures.length > 1) {
        fixtureIndexHistory = [0];
        startAutoSlide(fixtures); 
    } else {
        clearInterval(autoSlideInterval); 
    }
}

function goToRandomSlide(fixtures) {
    if (fixtures.length === 0) return;
    let nextIndex;

    if (fixtureIndexHistory.length === fixtures.length) {
        fixtureIndexHistory = [];
    }

    do {
        nextIndex = Math.floor(Math.random() * fixtures.length);
    } while (fixtureIndexHistory.includes(nextIndex)); 

    fixtureIndexHistory.push(nextIndex);
    const match = fixtures[nextIndex];

    const dynamicCard = document.getElementById('dynamicHeroCard');
    const sportKey = currentSport || 'live';
    const backgroundUrl = SPORT_BACKGROUNDS[sportKey] || SPORT_BACKGROUNDS['live'];
    const leagueLogo = match.logo_url || 'https://via.placeholder.com/30/0f3460/ffffff?text=L';
    const leagueName = match.league || 'Unknown League';

    heroCarouselSection.style.backgroundImage = backgroundUrl;
    dynamicCard.innerHTML = `
        <div class="hero-content">
            <div class="hero-league-info">
                <img src="${leagueLogo}" alt="${leagueName} Logo" class="hero-league-logo" onerror="this.onerror=null; this.src='https://via.placeholder.com/30/0f3460/ffffff?text=L';">
                <span class="hero-league-name">${leagueName} - ${match.time}</span>
            </div>
            <h1 class="hero-title">${match.fixture}</h1>
            <p class="hero-subtitle">Upcoming Match</p>
            <button class="btn btn-primary hero-btn view-details-btn" data-fixture='${JSON.stringify(match).replace(/'/g, "&#39;")}'>
                <i class="fas fa-eye"></i> View Details
            </button>
        </div>
    `;

    document.querySelector('.view-details-btn').addEventListener('click', function() {
        const fixtureData = this.getAttribute('data-fixture');
        const fixture = JSON.parse(fixtureData.replace(/&#39;/g, "'"));
        openModal(fixture);
    });
}

function startAutoSlide(fixtures) {
    clearInterval(autoSlideInterval); 
    if (fixtures.length > 1) {
        autoSlideInterval = setInterval(() => goToRandomSlide(fixtures), 6000); 
    }
}

// Match Grid Renderers
function renderMatches(container, fixtures, isLive = false) {
    container.innerHTML = ''; 

    if (fixtures.length === 0) {
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-secondary);">
                <i class="fas fa-search-minus"></i> No ${isLive ? 'live' : 'scheduled'} matches available right now.
            </div>
        `;
        return;
    }

    const uniqueFixtures = [];
    const seenFixtures = new Set();

    fixtures.forEach(match => {
        const key = `${match.fixture}-${match.time}-${match.league}`;
        if (!seenFixtures.has(key)) {
            seenFixtures.add(key);
            uniqueFixtures.push(match);
        }
    });

    uniqueFixtures.forEach(match => {
        const streamUrl = match.stream_url && match.stream_url !== 'N/A' ? match.stream_url : '#';
        const isActuallyLive = isLive && streamUrl !== '#';
        const buttonText = isActuallyLive ? 'Watch Live' : 'View Details';
        const buttonBackground = isActuallyLive ? 'var(--highlight)' : 'var(--accent)';
        const timeColor = isActuallyLive ? 'var(--highlight)' : 'var(--text-secondary)';
        const icon = isActuallyLive ? 'fas fa-eye' : 'fas fa-info-circle';
        const logoSrc = (match.logo_url && match.logo_url !== 'N/A') ? match.logo_url : 'https://via.placeholder.com/60/0f3460/ffffff?text=LOGO';

        const cardLink = document.createElement('div');
        cardLink.classList.add('match-card-link');
        
        if (!isLive && currentSport === 'live') {
            cardLink.classList.add('scheduled-match');
        }
        
        cardLink.addEventListener('click', function() {
            openModal(match);
        });

        cardLink.innerHTML = `
            <div class="match-card">
                <div class="match-info">
                    <div class="match-logo">
                        <img src="${logoSrc}" alt="${match.league} Logo" onerror="this.onerror=null; this.src='https://via.placeholder.com/60/0f3460/ffffff?text=LOGO';">
                    </div>
                    <h3>${match.fixture}</h3>
                    <p style="color: ${timeColor};">
                        ${match.league}
                    </p>
                    <p>
                        ${match.time}
                    </p>
                </div>
                <button class="btn btn-primary stream-btn-visual" 
                        style="background-color: ${buttonBackground};">
                    <i class="${icon}"></i> ${buttonText}
                </button>
            </div>
        `;
        container.appendChild(cardLink);
    });
}

// Footer Renderer
async function renderFooterLeagues(sport) {
    const fixtures = await fetchHeroFixtures(sport);
    const uniqueLeagues = new Map();

    fixtures.forEach(match => {
        const league = match.league;
        if (league && league !== 'N/A') {
            uniqueLeagues.set(league.toLowerCase(), league); 
        }
    });

    // Sort leagues by priority
    const sortedLeagues = Array.from(uniqueLeagues.values()).sort((a, b) => {
        const priorityA = LEAGUE_PRIORITY[a.toLowerCase()] || LEAGUE_PRIORITY.default;
        const priorityB = LEAGUE_PRIORITY[b.toLowerCase()] || LEAGUE_PRIORITY.default;
        return priorityB - priorityA;
    });

    footerLeagueLinks.innerHTML = '';

    if (sortedLeagues.length === 0) {
        footerLeagueLinks.innerHTML = `
            <div class="footer-section" style="flex: 1 1 100%;">
                <p style="color: var(--text-secondary); text-align: center;">No featured leagues found for ${SPORTS[sport].name}.</p>
            </div>
        `;
        return;
    }

    const numLeagues = sortedLeagues.length;
    const colSize = Math.ceil(numLeagues / 3); 

    for (let i = 0; i < 3; i++) {
        const start = i * colSize;
        const end = start + colSize;
        const leaguesSlice = sortedLeagues.slice(start, end);
        if (leaguesSlice.length > 0) {
            const section = document.createElement('div');
            section.classList.add('footer-section');
            section.innerHTML = `
                <h4>${SPORTS[sport].name} Leagues</h4>
                <ul>
                    ${leaguesSlice.map(league => `
                        <li>
                            <a href="#" onclick="navigateToSchedule({sport: '${sport}', league: '${league}'}); return false;">
                                ${league}
                            </a>
                        </li>
                    `).join('')}
                </ul>
            `;
            footerLeagueLinks.appendChild(section);
        }
    }
}

// Search Functionality
function handleSearch() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    if (searchTerm.length === 0) {
        searchResults.style.display = 'none';
        return;
    }

    // Combine all fixtures for search based on current sport
    let searchFixtures = [];
    if (currentSport === 'live') {
        searchFixtures = [...liveFixtures, ...upcomingFixtures];
    } else {
        searchFixtures = allFixtures;
    }

    // Filter fixtures based on search term
    const filteredFixtures = searchFixtures.filter(fixture => {
        const fixtureName = fixture.fixture ? fixture.fixture.toLowerCase() : '';
        const leagueName = fixture.league ? fixture.league.toLowerCase() : '';
        const teamHome = fixture.team_home ? fixture.team_home.toLowerCase() : '';
        const teamAway = fixture.team_away ? fixture.team_away.toLowerCase() : '';
        return fixtureName.includes(searchTerm) || 
               leagueName.includes(searchTerm) || 
               teamHome.includes(searchTerm) || 
               teamAway.includes(searchTerm);
    });

    // Remove duplicates
    const uniqueFixtures = [];
    const seenFixtures = new Set();
    filteredFixtures.forEach(fixture => {
        const key = `${fixture.fixture}-${fixture.time}-${fixture.league}`;
        if (!seenFixtures.has(key)) {
            seenFixtures.add(key);
            uniqueFixtures.push(fixture);
        }
    });

    displaySearchResults(uniqueFixtures);
}

function displaySearchResults(results) {
    if (results.length === 0) {
        searchResults.innerHTML = '<div class="search-result-item">No matches found</div>';
    } else {
        searchResults.innerHTML = results.map(fixture => {
            let sportCategory = 'Live';
            if (currentSport === 'others') {
                sportCategory = 'Other Sports';
            }

            const matchStatus = getMatchStatus(fixture);
            const isLive = matchStatus === 'live';
            const pageContext = isLive ? 'Live' : 'Scheduled';

            return `
                <div class="search-result-item" data-fixture='${JSON.stringify(fixture).replace(/'/g, "&#39;")}'>
                    <div class="match-name">${fixture.fixture} <span class="match-sport">${sportCategory}</span></div>
                    <div class="match-league">${fixture.league} • ${fixture.time} • ${pageContext}</div>
                </div>
            `;
        }).join('');

        document.querySelectorAll('.search-result-item').forEach(item => {
            item.addEventListener('click', function() {
                const fixtureData = this.getAttribute('data-fixture');
                const fixture = JSON.parse(fixtureData.replace(/&#39;/g, "'"));
                openModal(fixture);
                searchResults.style.display = 'none';
                searchInput.value = '';
            });
        });
    }
    searchResults.style.display = 'block';
}

// Main Sport Switching Function
window.switchSport = async function(sport) {
    currentSport = sport;
    sportTitleElement.textContent = SPORTS[sport].name;

    // Update section visibility
    if (sport === 'live') {
        showLiveSections();
    } else {
        showOthersSection();
    }

    // Show loading states
    const backgroundUrl = SPORT_BACKGROUNDS[sport] || SPORT_BACKGROUNDS['live'];
    heroCarouselSection.style.backgroundImage = backgroundUrl;
    heroCarouselSection.style.backgroundSize = 'cover';
    heroCarouselSection.style.backgroundPosition = 'center';

    heroCarouselContainer.innerHTML = `
        <div class="hero-card" style="background-image: ${backgroundUrl};">
            <div class="hero-content" style="text-align: center;">
                <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--highlight);"></i>
                <h1 class="hero-title" style="margin-top: 15px;">Loading Upcoming Events...</h1>
            </div>
        </div>
    `;

    if (sport === 'live') {
        liveContainer.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> Loading Live Matches...</p>`;
        featuredContainer.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> Loading Featured Matches...</p>`;
        upcomingContainer.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> Loading Upcoming Matches...</p>`;
    } else {
        othersContainer.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> Loading Other Sports...</p>`;
    }

    footerLeagueLinks.innerHTML = `<p style="flex: 1 1 100%; color: var(--text-secondary); text-align: center;">Loading featured leagues...</p>`;

    // Fetch and render data based on sport
    if (sport === 'live') {
        const [fetchedHeroFixtures, fetchedLive, fetchedUpcoming] = await Promise.all([
            fetchHeroFixtures(sport),
            fetchLiveFixtures(),
            fetchUpcomingFixtures()
        ]);

        // Adjust timezone
        const heroFixtures = adjustTimezoneOffset(fetchedHeroFixtures, -1);
        const liveData = adjustTimezoneOffset(fetchedLive, -1);
        const upcomingData = adjustTimezoneOffset(fetchedUpcoming, -1);

        // Store for search
        liveFixtures = liveData;
        upcomingFixtures = upcomingData;

        // Get featured matches (intelligently prioritized)
        const featuredMatches = getFeaturedMatches(upcomingData);

        renderHeroCarousel(heroFixtures);
        renderMatches(liveContainer, liveData, true);
        renderMatches(featuredContainer, featuredMatches, false);
        renderMatches(upcomingContainer, upcomingData, false);
    } else {
        const [fetchedHeroFixtures, fetchedUpcoming] = await Promise.all([
            fetchHeroFixtures(sport),
            fetchUpcomingFixtures()
        ]);

        // Adjust timezone
        const heroFixtures = adjustTimezoneOffset(fetchedHeroFixtures, -1);
        const upcomingData = adjustTimezoneOffset(fetchedUpcoming, -1);

        // Store for search
        allFixtures = upcomingData;

        renderHeroCarousel(heroFixtures);
        renderMatches(othersContainer, upcomingData, false);
    }

    // Render footer leagues
    await renderFooterLeagues(sport);
}

// Notification and Modal Functions (unchanged)
function toggleNotificationPanel() {
    notificationPanel.classList.toggle('active');
}

function closeNotificationPanel() {
    notificationPanel.classList.remove('active');
}

function updateNotificationBadge() {
    const count = userReminders.length;
    notificationBadge.textContent = count;
    if (count > 0) {
        notificationBadge.style.display = 'flex';
    } else {
        notificationBadge.style.display = 'none';
    }
}

function renderNotificationList() {
    if (userReminders.length === 0) {
        notificationList.innerHTML = `
            <div class="notification-item">
                <p>No reminders set yet. Set reminders for matches you don't want to miss!</p>
            </div>
        `;
        return;
    }
    notificationList.innerHTML = userReminders.map((reminder, index) => {
        const matchStatus = getMatchStatus(reminder);
        const isLive = matchStatus === 'live';
        return `
            <div class="notification-item">
                <div class="notification-match">${reminder.fixture}</div>
                <div class="notification-time">${reminder.time} • ${reminder.league}</div>
                <div class="notification-actions">
                    ${isLive ? `
                    <button class="notification-btn watch" onclick="watchReminder('${reminder.stream_url}')">
                        <i class="fas fa-eye"></i> Watch Live
                    </button>
                    ` : ''}
                    <button class="notification-btn remove" onclick="removeReminder(${index})">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

function watchReminder(streamUrl) {
    if (streamUrl && streamUrl !== 'N/A' && streamUrl !== '#') {
        window.open(streamUrl, '_blank');
    } else {
        alert('No stream available for this match yet.');
    }
}

function removeReminder(index) {
    userReminders.splice(index, 1);
    localStorage.setItem('vieusReminders', JSON.stringify(userReminders));
    updateNotificationBadge();
    renderNotificationList();
}

function startNotificationChecker() {
    notificationInterval = setInterval(() => {
        checkUpcomingMatches();
    }, 30000);
}

function checkUpcomingMatches() {
    const now = new Date();
    userReminders.forEach(reminder => {
        if (Math.random() > 0.7) {
            showToastNotification(reminder);
        }
    });
}

function showToastNotification(reminder) {
    toastMatch.textContent = reminder.fixture;
    toastTime.textContent = `Starts at ${reminder.time}`;
    toastNotification.classList.add('active');
    setTimeout(() => {
        toastNotification.classList.remove('active');
    }, 5000);
}

function openModal(fixture) {
    currentModalFixture = fixture;
    modalMatchTitle.textContent = fixture.fixture || 'Match Details';
    modalMatchLeague.textContent = fixture.league || 'Unknown League';
    modalMatchTime.textContent = fixture.time || 'Time not specified';
    modalMatchVenue.textContent = fixture.venue || 'Venue not specified';
    modalMatchStatus.textContent = fixture.status || 'Scheduled';
    modalMatchBroadcast.textContent = fixture.broadcast || 'Check schedule for broadcast details';

    if (fixture.stream_url && fixture.stream_url !== 'N/A' && fixture.stream_url !== '#') {
        modalWatchBtn.disabled = false;
        modalWatchBtn.innerHTML = '<i class="fas fa-eye"></i> Watch Now';
    } else {
        modalWatchBtn.disabled = true;
        modalWatchBtn.innerHTML = '<i class="fas fa-eye-slash"></i> No Stream Available';
    }

    const isAlreadyReminded = userReminders.some(r => 
        r.fixture === fixture.fixture && r.time === fixture.time
    );
    if (isAlreadyReminded) {
        modalReminderBtn.disabled = true;
        modalReminderBtn.innerHTML = '<i class="fas fa-bell-slash"></i> Already Reminded';
    } else {
        modalReminderBtn.disabled = false;
        modalReminderBtn.innerHTML = '<i class="far fa-bell"></i> Set Reminder';
    }

    modalCrossReferences.innerHTML = '';
    matchModal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    matchModal.classList.remove('active');
    document.body.style.overflow = 'auto';
    currentModalFixture = null;
}

function setReminder(fixture) {
    const isAlreadyReminded = userReminders.some(r => 
        r.fixture === fixture.fixture && r.time === fixture.time
    );
    if (isAlreadyReminded) {
        alert('You already have a reminder for this match!');
        return;
    }

    userReminders.push({
        fixture: fixture.fixture,
        league: fixture.league,
        time: fixture.time,
        stream_url: fixture.stream_url,
        sport: currentSport,
        added: new Date().toISOString()
    });

    localStorage.setItem('vieusReminders', JSON.stringify(userReminders));
    updateNotificationBadge();
    renderNotificationList();
    alert(`Reminder set for: ${fixture.fixture} at ${fixture.time}`);
    modalReminderBtn.disabled = true;
    modalReminderBtn.innerHTML = '<i class="fas fa-bell-slash"></i> Already Reminded';
}

// Initialize with live
currentSport = 'live';
</script>
</body>
</html>