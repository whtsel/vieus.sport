<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vieus Sport - Football Streams</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root{--primary-blue:#00ccff;--dark-bg:#0a0a12;--graphite:#1a1a1a;--wine-red:#8b0000;--cream-yellow:#fff8e1;--orange-cream:#ffd7b5;--cyan:#00ccff;--text-light:#fff;--text-gray:#ccc;--glass-white:rgba(255,255,255,.1);--hot-color:#ff3366;--blue-gray:#5d7b9d;--countdown-red:#ff4444;--stream-red:#ff0000;}
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;}
        body{background:var(--dark-bg);color:var(--text-light);min-height:100vh;overflow-x:hidden;padding-bottom:60px;}
        body::before{content:'';position:fixed;inset:0;background:url('https://images.unsplash.com/photo-1543353074-8c8c8c6b7c1c?q=80&w=2070&auto=format&fit=crop');background-size:cover;background-position:center;opacity:.08;z-index:-1;}
        .container{max-width:1400px;margin:0 auto;padding:0 16px;}

        /* ---------- header grid for desktop ---------- */
        @media(min-width:769px){
            .header-content{
                display:grid;
                grid-template-columns:auto 1fr auto;
                align-items:center;
                gap:15px;
                grid-template-areas:
                    "logo sport-tab search"
                    "status status search";
            }
            .logo{grid-area:logo;}
            .sport-header-tab{grid-area:sport-tab;}
            .guest-status{grid-area:status;margin-right:0;justify-self:start;}
            .visit-counter{grid-area:status;justify-self:end;margin-left:8px;}
            .search-container{grid-area:search;margin-left:auto;}
        }

        header{background:var(--graphite);padding:12px 0;position:sticky;top:0;z-index:100;border-bottom:1px solid var(--glass-white);}
        .logo{font-size:1.4rem;font-weight:700;color:#fff;display:flex;align-items:center;gap:8px;}
        .logo i{color:var(--cyan);font-size:1.6rem;}
        .sport-header-tab{background:var(--cyan);color:var(--graphite);padding:8px 20px;border-radius:20px;font-weight:600;display:flex;align-items:center;gap:8px;margin-right:auto;}
        .guest-status{display:flex;align-items:center;gap:8px;font-size:.85rem;background:rgba(255,255,255,.1);padding:6px 12px;border-radius:20px;margin-right:15px;flex-shrink:0;}
        .guest-status i{color:#ffcc00;}
        .guest-timer{font-weight:bold;color:#ffcc00;}
        .visit-counter{background:var(--wine-red);color:#fff;padding:6px 12px;border-radius:20px;font-size:.85rem;font-weight:600;display:flex;align-items:center;gap:6px;flex-shrink:0;}
        .visit-counter i{font-size:.8rem;}
        .search-container{display:flex;align-items:center;gap:10px;}
        .search-bar{background:rgba(255,255,255,.1);border:1px solid var(--glass-white);border-radius:25px;padding:10px 20px;color:var(--text-light);font-size:.9rem;width:100%;max-width:300px;transition:all .3s;}
        .search-bar:focus{outline:none;border-color:var(--cyan);background:rgba(255,255,255,.15);max-width:350px;}
        .search-btn{background:var(--cyan);color:var(--graphite);border:none;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;flex-shrink:0;}
        .search-btn:hover{background:#00a8e0;transform:scale(1.05);}

        /* notification bar */
        .notification-bar{position:fixed;top:70px;right:20px;background:var(--wine-red);color:#fff;padding:12px 20px;border-radius:10px;display:flex;align-items:center;gap:10px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,.3);transform:translateX(150%);transition:transform .5s ease-in-out;max-width:400px;animation:slideIn .5s ease-out forwards;}
        @keyframes slideIn{from{transform:translateX(150%);}to{transform:translateX(0);}}
        .notification-bar.show{transform:translateX(0);}
        .notification-icon{font-size:1.2rem;}
        .notification-content{flex:1;}
        .notification-title{font-weight:600;font-size:.9rem;}
        .notification-message{font-size:.8rem;opacity:.9;}
        .notification-close{background:none;border:none;color:#fff;cursor:pointer;font-size:.9rem;opacity:.7;transition:opacity .3s;}
        .notification-close:hover{opacity:1;}

        /* guest modal */
        .guest-modal{position:fixed;inset:0;background:rgba(0,0,0,.9);backdrop-filter:blur(5px);display:flex;align-items:center;justify-content:center;z-index:2000;padding:20px;}
        .guest-modal-content{background:var(--graphite);border-radius:20px;width:100%;max-width:500px;padding:40px;border:2px solid var(--cyan);text-align:center;animation:slideUp .3s ease;}
        @keyframes slideUp{from{transform:translateY(20px);opacity:0;}to{transform:translateY(0);opacity:1;}}
        .guest-modal-icon{font-size:4rem;color:var(--cyan);margin-bottom:20px;}
        .guest-modal-title{font-size:2rem;font-weight:700;color:#fff;margin-bottom:15px;}
        .guest-modal-text{color:var(--text-gray);margin-bottom:30px;line-height:1.6;}
        .guest-timer-large{font-size:2.5rem;font-weight:900;color:#ffcc00;margin:20px 0;font-family:'Courier New',monospace;}
        .guest-stats{background:rgba(255,255,255,.05);border-radius:12px;padding:20px;margin:20px 0;border:1px solid var(--glass-white);}
        .stat-item{display:flex;justify-content:space-between;align-items:center;margin:10px 0;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.1);}
        .stat-item:last-child{border-bottom:none;}
        .stat-label{color:var(--text-gray);}
        .stat-value{color:#fff;font-weight:600;}

        /* session expired modal */
        .session-expired-modal{position:fixed;inset:0;background:rgba(0,0,0,.95);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:2001;padding:20px;}
        .session-expired-content{background:var(--graphite);border-radius:20px;width:100%;max-width:500px;padding:40px;border:2px solid var(--wine-red);text-align:center;animation:slideUp .3s ease;}
        .session-expired-icon{font-size:4rem;color:var(--wine-red);margin-bottom:20px;}
        .session-expired-title{font-size:2rem;font-weight:700;color:#fff;margin-bottom:15px;}
        .session-expired-text{color:var(--text-gray);margin-bottom:30px;line-height:1.6;}
        .session-expired-actions{display:flex;gap:15px;margin-top:30px;justify-content:center;}
        .session-expired-btn{padding:15px 30px;border:none;border-radius:25px;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;font-size:.95rem;text-transform:uppercase;letter-spacing:.5px;}
        .session-expired-btn.restart{background:var(--cyan);color:var(--graphite);}
        .session-expired-btn.restart:hover{background:#00a8e0;transform:translateY(-2px);}
        .session-expired-btn.close{background:var(--graphite);color:var(--text-light);border:2px solid var(--glass-white);}
        .session-expired-btn.close:hover{background:rgba(255,255,255,.1);transform:translateY(-2px);}

        /* league grouping */
        .league-section{margin-bottom:30px;}
        .league-header{background:linear-gradient(90deg,rgba(139,0,0,.2),rgba(22,22,32,.8));padding:12px 20px;border-radius:12px;margin:20px 0 15px;display:flex;justify-content:space-between;align-items:center;border-left:4px solid var(--wine-red);cursor:pointer;transition:all .3s ease;border:1px solid rgba(255,255,255,.1);position:relative;overflow:hidden;}
        .hot-indicator{position:absolute;top:-10px;left:-10px;background:var(--hot-color);color:#fff;font-size:.7rem;font-weight:700;padding:12px 15px 5px;transform:rotate(-45deg);transform-origin:center;z-index:2;box-shadow:0 2px 5px rgba(0,0,0,.3);}
        .hot-indicator::after{content:"HOT";display:block;transform:rotate(45deg);text-align:center;}
        .league-header:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(139,0,0,.3);border-left:4px solid var(--cyan);}
        .league-header-content{display:flex;align-items:center;gap:12px;width:calc(100% - 100px);}
        .league-icon{width:36px;height:36px;border-radius:8px;background:rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
        .league-icon i{color:var(--cyan);font-size:1.1rem;}
        .league-name{font-size:1.2rem;font-weight:600;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .match-count{background:var(--wine-red);color:#fff;padding:5px 15px;border-radius:20px;font-size:.85rem;font-weight:700;flex-shrink:0;}
        .league-matches{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:10px;}
        .league-section.collapsed .league-matches{display:none;}

        /* match cards */
        .match-card{background:var(--graphite);border-radius:16px;padding:20px;transition:all .3s ease;position:relative;overflow:hidden;display:flex;flex-direction:column;align-items:center;border:1px solid rgba(255,255,255,.1);min-height:400px;}
        .match-card.live{border:2px solid var(--wine-red);border-left:4px solid var(--wine-red);}
        .match-card.live .team-name,.match-card.live .match-league{color:#fff!important;}
        .match-card.live .match-time{color:var(--cream-yellow)!important;font-weight:700;}
        .match-card.upcoming{background:var(--orange-cream);border:2px solid #ff9a3c;}
        .match-card.upcoming .team-name,.match-card.upcoming .match-league{color:#333!important;}
        .match-card.upcoming .match-time{color:#333!important;font-weight:600;}
        .match-card.upcoming .team-logo{border:2px solid rgba(0,0,0,.1);}
        .match-status{position:absolute;top:15px;right:15px;padding:6px 15px;border-radius:15px;font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;z-index:2;}
        .status-live{background:var(--cream-yellow);color:var(--wine-red);font-weight:bold;}
        .status-upcoming{background:#333;color:var(--orange-cream);font-weight:bold;}
        .match-info-header{margin-bottom:20px;text-align:center;width:100%;padding:0 10px;}
        .match-league{font-size:.9rem;font-weight:600;margin-bottom:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding:0 5px;color:#333;letter-spacing:.3px;}
        .match-time{font-size:1.05rem;font-weight:800;color:#000;letter-spacing:.5px;text-transform:uppercase;background:rgba(255,255,255,.9);padding:6px 12px;border-radius:8px;display:inline-block;margin-top:5px;box-shadow:0 2px 5px rgba(0,0,0,.1);}
        .match-card.live .match-time{background:var(--wine-red);color:#fff!important;}
        .teams-display{display:flex;justify-content:center;align-items:center;gap:20px;margin:20px 0 30px;width:100%;position:relative;}
        .team{display:flex;flex-direction:column;align-items:center;flex:1;}
        .team-logo{width:85px;height:85px;margin-bottom:12px;border-radius:50%;overflow:hidden;border:3px solid #f5f5f5;background:#f8f8f8;padding:12px;box-shadow:0 6px 20px rgba(0,0,0,.6),0 0 30px rgba(0,0,0,.4),inset 0 0 15px rgba(255,255,255,.9);transition:all .4s ease;position:relative;}
        .match-card.upcoming .team-logo{background:#f8f8f8;border:3px solid rgba(255,107,53,.3);box-shadow:0 6px 20px rgba(0,0,0,.5),0 0 25px rgba(0,0,0,.3),inset 0 0 15px rgba(255,255,255,.9);}
        .team-logo:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 10px 30px rgba(0,0,0,.8),0 0 40px rgba(0,0,0,.6),0 0 0 3px rgba(0,0,0,.3),inset 0 0 20px rgba(255,255,255,.8);border-color:rgba(0,204,255,.5);}
        .match-card.upcoming .team-logo:hover{box-shadow:0 10px 30px rgba(0,0,0,.7),0 0 40px rgba(0,0,0,.5),0 0 0 3px rgba(255,107,53,.3),inset 0 0 20px rgba(255,255,255,.8);border-color:rgba(255,107,53,.5);}
        .team-logo::before{content:'';position:absolute;top:-5px;left:-5px;right:-5px;bottom:-5px;background:radial-gradient(circle at center,rgba(0,0,0,.4) 0%,rgba(0,0,0,.2) 50%,transparent 70%);border-radius:50%;z-index:-1;opacity:0;transition:opacity .4s ease;}
        .team-logo:hover::before{opacity:1;}
        .team-logo img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3));transition:all .3s ease;}
        .team-logo:hover img{filter:drop-shadow(0 4px 8px rgba(0,0,0,.5)) brightness(1.05);transform:scale(1.05);}
        .team-name{font-size:.95rem;font-weight:700;text-align:center;max-width:120px;overflow:hidden;text-overflow:ellipsis;color:#333;background:rgba(255,255,255,.9);padding:4px 8px;border-radius:6px;margin-top:5px;box-shadow:0 2px 4px rgba(0,0,0,.1);}
        .match-card.live .team-name{background:rgba(139,0,0,.1);color:#fff;}
        .vs-divider{font-size:1.4rem;font-weight:900;color:var(--cyan);position:relative;z-index:1;text-shadow:0 2px 4px rgba(0,0,0,.3);padding:5px 10px;background:rgba(0,0,0,.2);border-radius:8px;}
        .match-card.upcoming .vs-divider{color:#ff5722;background:rgba(0,0,0,.1);}
        .countdown-section{width:100%;display:flex;justify-content:center;margin:10px 0 30px;}
        .countdown-container{background:var(--countdown-red);color:#fff;padding:10px 25px;border-radius:15px;font-size:.9rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;box-shadow:0 4px 15px rgba(255,68,68,.3),0 0 20px rgba(255,68,68,.2);z-index:2;width:auto;white-space:nowrap;border:2px solid rgba(255,255,255,.3);min-width:140px;text-align:center;position:relative;}
        .match-card.live .countdown-container{display:none;}
        .countdown-timer{font-family:'Courier New',monospace;font-size:1.1rem;letter-spacing:2px;font-weight:900;text-shadow:0 1px 3px rgba(0,0,0,.5);}
        @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.03);}}
        .countdown-container{animation:pulse 1.5s infinite;}
        .watch-btn-container{width:100%;margin-top:auto;display:flex;justify-content:center;}
        .watch-btn{padding:12px 40px;background:var(--cyan);color:var(--graphite);border:none;border-radius:25px;font-weight:700;cursor:pointer;transition:all .3s;font-size:.95rem;display:flex;align-items:center;gap:8px;text-transform:uppercase;letter-spacing:.5px;}
        .watch-btn:hover{background:#00a8e0;transform:translateY(-2px);}
        .match-card.upcoming .watch-btn{background:#ff6b35;color:#fff;}
        .match-card.upcoming .watch-btn:hover{background:#ff5722;}

        /* section header / modal */
        .section-header{display:flex;align-items:center;gap:15px;margin:30px 0 20px;}
        .back-btn{background:var(--graphite);border:1px solid var(--glass-white);color:var(--text-light);width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;}
        .back-btn:hover{background:var(--cyan);color:var(--graphite);transform:translateX(-3px);}
        .section-title{font-size:1.5rem;font-weight:600;color:#fff;display:flex;align-items:center;gap:10px;}
        .section-title i{color:var(--cyan);}
        .section-actions{display:flex;gap:8px;margin-left:auto;}
        .action-btn{padding:8px 16px;background:var(--graphite);border:1px solid var(--glass-white);border-radius:10px;color:var(--text-light);font-size:.85rem;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:6px;}
        .action-btn:hover{background:var(--cyan);color:var(--graphite);}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.95);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;z-index:2000;padding:20px;}
        .modal-overlay.active{display:flex;animation:fadeIn .3s ease;}
        @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
        .modal-content{background:var(--graphite);border-radius:20px;width:100%;max-width:800px;max-height:90vh;overflow-y:auto;padding:30px;border:2px solid var(--wine-red);animation:slideUp .3s ease;}
        .modal-header{text-align:center;margin-bottom:30px;position:relative;}
        .modal-title{font-size:2rem;font-weight:700;color:#fff;line-height:1.2;margin-bottom:10px;}
        .modal-competition{color:var(--cyan);font-weight:600;font-size:1.1rem;margin-bottom:20px;padding:0 20px;}
        .modal-rating{color:#ffcc00;font-size:1.3rem;margin:10px 0 20px;}
        .modal-close{position:absolute;top:-10px;right:-10px;background:var(--graphite);border:1px solid var(--glass-white);color:var(--text-gray);width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.2rem;transition:all .3s;}
        .modal-close:hover{background:var(--cyan);color:var(--graphite);transform:rotate(90deg);}
        .modal-teams{display:flex;justify-content:center;align-items:center;gap:40px;margin:30px 0;}
        .modal-team{display:flex;flex-direction:column;align-items:center;}
        .modal-team-logo{width:140px;height:140px;border-radius:50%;overflow:hidden;border:3px solid var(--cream-yellow);background:#f8f8f8;padding:15px;margin-bottom:15px;box-shadow:0 8px 25px rgba(0,0,0,.6),0 0 35px rgba(0,0,0,.4),inset 0 0 20px rgba(255,255,255,.8);}
        .modal-team-logo img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 3px 5px rgba(0,0,0,.5));}
        .modal-team-name{font-size:1.2rem;font-weight:600;color:#fff;text-align:center;max-width:200px;}
        .modal-vs{font-size:2.5rem;font-weight:700;color:var(--cyan);}
        .modal-streams{background:rgba(255,255,255,.05);border-radius:12px;padding:20px;margin:20px 0;border:1px solid rgba(255,255,255,.1);display:none;}
        .modal-streams.active{display:block;}
        .streams-title{font-size:1.1rem;font-weight:600;color:#fff;margin-bottom:15px;display:flex;align-items:center;gap:8px;}
        .streams-title i{color:var(--cyan);}
        .streams-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;}
        .stream-item{background:linear-gradient(135deg,rgba(255,0,0,.1),rgba(139,0,0,.2));border-radius:12px;padding:15px;cursor:pointer;transition:all .3s ease;border:2px solid var(--stream-red);text-align:center;position:relative;overflow:hidden;}
        .stream-item:hover{background:linear-gradient(135deg,rgba(255,0,0,.2),rgba(139,0,0,.3));transform:translateY(-3px);box-shadow:0 5px 15px rgba(255,0,0,.3);}
        .stream-item::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,0,0,.1) 0%,transparent 70%);opacity:0;transition:opacity .3s;}
        .stream-item:hover::before{opacity:1;}
        .stream-tv-icon{color:var(--stream-red);font-size:2rem;margin-bottom:10px;display:block;text-shadow:0 0 10px rgba(255,0,0,.5);}
        .stream-watch-now{color:#fff;font-weight:700;font-size:.9rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:5px;animation:blink 1.5s infinite;text-shadow:0 0 5px rgba(255,255,255,.5);}
        @keyframes blink{0%,100%{opacity:1;}50%{opacity:.5;}}
        .stream-language{font-weight:700;color:var(--cream-yellow);font-size:1rem;margin-bottom:5px;}
        .stream-quality{color:#ffcc99;font-size:.85rem;font-weight:600;}
        .no-streams{text-align:center;padding:40px 20px;color:var(--text-gray);}
        .no-streams i{font-size:3rem;margin-bottom:15px;opacity:.5;color:var(--stream-red);}
        .no-streams h4{color:#fff;margin-bottom:10px;}
        .no-streams p{font-size:.9rem;opacity:.8;}
        .modal-actions{display:flex;gap:15px;margin-top:30px;}
        .modal-btn{flex:1;padding:15px;border:none;border-radius:25px;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;font-size:.95rem;text-transform:uppercase;letter-spacing:.5px;}
        .modal-btn.primary{background:var(--cyan);color:var(--graphite);}
        .modal-btn.primary:hover{background:#00a8e0;transform:translateY(-2px);}
        .modal-btn.secondary{background:var(--graphite);color:var(--text-light);border:2px solid var(--glass-white);}
        .modal-btn.secondary:hover{background:rgba(255,255,255,.1);transform:translateY(-2px);}

        /* mobile dock */
        .mobile-dock{position:fixed;bottom:0;left:0;right:0;background:var(--graphite);padding:12px 0;border-top:1px solid var(--glass-white);z-index:1000;display:flex;justify-content:space-around;}
        .dock-item{display:flex;flex-direction:column;align-items:center;color:var(--text-gray);font-size:.7rem;padding:8px 12px;cursor:pointer;transition:all .3s;border-radius:12px;min-width:60px;position:relative;}
        .dock-item i{font-size:1.4rem;margin-bottom:4px;transition:all .3s;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;}
        .dock-item[data-view="home"] i{background:var(--cyan);color:#000;}
        .dock-item[data-view="live"] i{background:#ff0000;color:#000;border-radius:8px;}
        .dock-item[data-view="upcoming"] i{background:var(--orange-cream);color:#333;}
        .dock-item[data-view="account"] i{background:#555;color:#fff;}
        .dock-item:hover{color:var(--text-light);}
        .dock-item.active{color:var(--cyan);transform:translateY(-5px);}
        .dock-item.active i{transform:scale(1.1);}
        .dock-item.active[data-view="home"] i{background:var(--cyan);color:#000;}
        .dock-item.active[data-view="live"] i{background:#ff3333;color:#000;}
        .dock-item.active[data-view="upcoming"] i{background:#ffcc99;color:#333;}
        .dock-item.active[data-view="account"] i{background:#777;color:#fff;}

        footer{background:var(--graphite);padding:30px 0 80px;margin-top:40px;border-top:1px solid var(--glass-white);}
        ::-webkit-scrollbar{width:8px;}
        ::-webkit-scrollbar-track{background:rgba(255,255,255,.1);}
        ::-webkit-scrollbar-thumb{background:var(--cyan);border-radius:4px;}

        /* minor responsive tweaks */
        @media(max-width:768px){
            .league-matches{grid-template-columns:1fr;}
            .mobile-dock{display:flex;}
            body{padding-bottom:70px;}
            .modal-content{padding:20px;}
            .modal-teams{gap:20px;}
            .modal-team-logo{width:100px;height:100px;}
            .modal-title{font-size:1.5rem;}
            .header-content{display:flex;flex-wrap:wrap;gap:10px;}
            .search-bar{width:100%;max-width:none;}
            .search-bar:focus{width:100%;max-width:none;}
            .notification-bar{top:60px;right:10px;left:10px;max-width:calc(100% - 20px);}
            .guest-status{order:3;width:auto;margin:0;}
            .visit-counter{order:4;}
            .league-header-content{width:calc(100% - 90px);}
            .league-name{font-size:1rem;max-width:100%;}
            .match-count{padding:5px 10px;font-size:.8rem;}
            .team-logo{width:70px;height:70px;}
            .countdown-container{font-size:.8rem;padding:8px 20px;min-width:120px;}
            .countdown-timer{font-size:.95rem;letter-spacing:1px;}
            .match-time{font-size:.95rem;padding:5px 10px;}
            .team-name{font-size:.85rem;padding:3px 6px;}
            .modal-competition{padding:0 10px;font-size:1rem;}
            .streams-list{grid-template-columns:1fr;}
            .stream-tv-icon{font-size:1.8rem;}
            .stream-watch-now{font-size:.85rem;}
            .session-expired-actions{flex-direction:column;}
            .session-expired-btn{width:100%;}
        }
        @media(min-width:769px){.mobile-dock{display:none;}body{padding-bottom:0;}footer{padding-bottom:30px;}}
        @media(max-width:480px){
            .header-content{flex-direction:column;align-items:stretch;}
            .team-logo{width:60px;height:60px;padding:8px;}
            .modal-content{padding:16px;}
            .modal-team-logo{width:80px;height:80px;}
            .modal-vs{font-size:1.8rem;}
            .search-bar{width:100%;}
            .search-bar:focus{width:100%;}
            .league-name{font-size:.9rem;}
            .match-league{font-size:.85rem;}
            .countdown-container{font-size:.75rem;padding:6px 15px;min-width:100px;}
            .countdown-timer{font-size:.85rem;letter-spacing:1px;}
            .match-time{font-size:.9rem;padding:4px 8px;}
            .team-name{font-size:.8rem;padding:2px 5px;}
            .modal-competition{font-size:.9rem;padding:0 5px;}
            .modal-actions{flex-direction:column;}
            .stream-tv-icon{font-size:1.5rem;}
            .stream-watch-now{font-size:.8rem;}
        }
    </style>
</head>
<body>
    <!-- Guest Account Modal -->
    <div class="guest-modal" id="guestModal">
        <div class="guest-modal-content">
            <div class="guest-modal-icon"><i class="fas fa-user-clock"></i></div>
            <h2 class="guest-modal-title">Welcome Guest!</h2>
            <p class="guest-modal-text">You're accessing Vieus Sport with a temporary 3-hour guest session. Enjoy live football streams and upcoming matches during your session.</p>
            <div class="guest-timer-large" id="guestTimerLarge">03:00:00</div>
            <div class="guest-stats">
                <div class="stat-item"><span class="stat-label">Your User ID:</span><span class="stat-value" id="userIdDisplay">USR-XXXX</span></div>
                <div class="stat-item"><span class="stat-label">Session ID:</span><span class="stat-value" id="sessionIdDisplay">SES-XXXX</span></div>
                <div class="stat-item"><span class="stat-label">Session Started:</span><span class="stat-value" id="sessionStartTime">Loading...</span></div>
                <div class="stat-item"><span class="stat-label">Session Expires:</span><span class="stat-value" id="sessionExpiryTime">Loading...</span></div>
                <div class="stat-item"><span class="stat-label">Total Unique Users:</span><span class="stat-value" id="totalUsers">0</span></div>
                <div class="stat-item"><span class="stat-label">Today's Visitors:</span><span class="stat-value" id="dailyVisitors">0</span></div>
            </div>
            <button class="modal-btn primary" id="continueBtn" style="margin-top:20px;"><i class="fas fa-play"></i> CONTINUE TO STREAMS</button>
        </div>
    </div>

    <!-- Session Expired Modal -->
    <div class="session-expired-modal" id="sessionExpiredModal">
        <div class="session-expired-content">
            <div class="session-expired-icon"><i class="fas fa-hourglass-end"></i></div>
            <h2 class="session-expired-title">Session Expired</h2>
            <p class="session-expired-text">Your 3-hour guest session has ended. You can start a new session to continue watching matches.</p>
            <div class="guest-stats">
                <div class="stat-item"><span class="stat-label">Your User ID:</span><span class="stat-value" id="expiredUserId">USR-XXXX</span></div>
                <div class="stat-item"><span class="stat-label">Previous Session ID:</span><span class="stat-value" id="expiredSessionId">SES-XXXX</span></div>
                <div class="stat-item"><span class="stat-label">Duration:</span><span class="stat-value">3 hours</span></div>
                <div class="stat-item"><span class="stat-label">Total Unique Users:</span><span class="stat-value" id="expiredTotalUsers">0</span></div>
                <div class="stat-item"><span class="stat-label">Today's Visitors:</span><span class="stat-value" id="expiredDailyVisitors">0</span></div>
            </div>
            <div class="session-expired-actions">
                <button class="session-expired-btn restart" id="restartSessionBtn"><i class="fas fa-redo"></i> START NEW SESSION</button>
                <button class="session-expired-btn close" id="closeExpiredModal"><i class="fas fa-times"></i> CLOSE</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo"><i class="fas fa-play-circle"></i><span>Vieus Sport</span></div>
                <div class="sport-header-tab"><i class="fas fa-futbol"></i>Football</div>
                <div class="guest-status" id="guestStatus">
                    <i class="fas fa-user-clock"></i>
                    <span>Session:</span>
                    <span class="guest-timer" id="guestTimer">03:00:00</span>
                </div>
                <div class="visit-counter" id="visitCounter">
                    <i class="fas fa-users"></i>
                    <span id="uniqueUserCount">0</span> users
                    <span id="dailyVisitorCount">0</span> today
                </div>
                <div class="search-container">
                    <input type="text" class="search-bar" id="searchBar" placeholder="Search matches, teams, leagues...">
                    <button class="search-btn" id="searchBtn"><i class="fas fa-search"></i></button>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification Bar -->
    <div class="notification-bar" id="notificationBar">
        <div class="notification-icon"><i class="fas fa-bell"></i></div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Reminder Set!</div>
            <div class="notification-message" id="notificationMessage">You'll be notified before the match starts</div>
        </div>
        <button class="notification-close" id="notificationClose"><i class="fas fa-times"></i></button>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="section-header">
            <button class="back-btn" id="backBtn" style="display:none;"><i class="fas fa-arrow-left"></i></button>
            <h2 class="section-title" id="sectionTitle"><i class="fas fa-broadcast-tower"></i> Live Matches</h2>
            <div class="section-actions"><button class="action-btn" id="refreshBtn"><i class="fas fa-redo"></i> Refresh</button></div>
        </div>
        <div id="liveContainer"></div>
        <div class="section-header"><h2 class="section-title"><i class="far fa-clock"></i> Upcoming Matches</h2></div>
        <div id="upcomingContainer"></div>
    </div>

    <!-- Mobile Dock -->
    <div class="mobile-dock">
        <div class="dock-item active" data-view="home"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="dock-item" data-view="live"><i class="fas fa-broadcast-tower"></i><span>Live</span></div>
        <div class="dock-item" data-view="upcoming"><i class="far fa-clock"></i><span>Upcoming</span></div>
        <div class="dock-item" data-view="account"><i class="fas fa-user-circle"></i><span>Account</span></div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo"><i class="fas fa-play-circle"></i>Vieus Sport - Football Streaming</div>
                <div class="copyright">&copy; 2024 Vieus Sport. Premium football streaming experience.</div>
            </div>
        </div>
    </footer>

    <!-- Preview Modal -->
    <div class="modal-overlay" id="matchModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" id="modalClose"><i class="fas fa-times"></i></button>
                <h3 class="modal-title" id="modalTitle">Match Details</h3>
                <div class="modal-competition" id="modalCompetition"></div>
                <div class="modal-rating" id="modalRating">★★★</div>
            </div>
            <div class="modal-teams" id="modalTeams"></div>
            <div class="modal-info-strip" id="modalInfoStrip"></div>
            <div class="modal-streams" id="modalStreams">
                <h4 class="streams-title"><i class="fas fa-stream"></i> Available Streams</h4>
                <div class="streams-list" id="streamsList"></div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="modalReminderBtn"><i class="far fa-bell"></i> SET REMINDER</button>
                <button class="modal-btn primary" id="modalWatchBtn"><i class="fas fa-play"></i> WATCH NOW</button>
            </div>
        </div>
    </div>

    <script>
        /* ===== USER AND SESSION MANAGER ===== */
        class UserSessionManager {
            constructor() {
                this.userId = null;
                this.sessionId = null;
                this.sessionStartTime = null;
                this.sessionExpiryTime = null;
                this.userData = null;
                this.notifications = [];
                this.activeNotifications = new Set();
                this.initializeUserAndSession();
            }
            
            initializeUserAndSession() {
                // Get or create User ID (persistent)
                this.userId = this.getOrCreateUserId();
                
                // Check for active session
                const activeSession = this.getActiveSession();
                if (activeSession) {
                    this.sessionId = activeSession.id;
                    this.sessionStartTime = activeSession.startTime;
                    this.sessionExpiryTime = activeSession.expiryTime;
                } else {
                    this.createNewSession();
                }
                
                this.userData = this.getUserData();
            }
            
            getOrCreateUserId() {
                let userId = localStorage.getItem('vieusUserId');
                if (!userId) {
                    userId = this.generateUserId();
                    localStorage.setItem('vieusUserId', userId);
                    
                    // Add to global user tracking
                    this.addUserToGlobalTracking(userId);
                }
                return userId;
            }
            
            generateUserId() {
                return 'USR-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            }
            
            generateSessionId() {
                return 'SES-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            }
            
            addUserToGlobalTracking(userId) {
                const today = new Date().toDateString();
                let globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                
                if (!globalData.users) globalData.users = {};
                if (!globalData.users[userId]) {
                    globalData.users[userId] = {
                        firstSeen: Date.now(),
                        lastSeen: Date.now(),
                        totalSessions: 0,
                        totalSessionTime: 0
                    };
                }
                
                // Update today's unique visitors
                if (!globalData.dailyStats) globalData.dailyStats = {};
                if (!globalData.dailyStats[today]) globalData.dailyStats[today] = { uniqueVisitors: new Set() };
                globalData.dailyStats[today].uniqueVisitors.add(userId);
                
                localStorage.setItem('vieusGlobalData', JSON.stringify(globalData));
            }
            
            getActiveSession() {
                const today = new Date().toDateString();
                const userSessions = JSON.parse(localStorage.getItem('vieusUserSessions')) || {};
                const userSessionData = userSessions[this.userId] || {};
                const todaySessions = userSessionData[today] || { active: [], completed: [] };
                
                return todaySessions.active.find(s => s.expiryTime > Date.now());
            }
            
            createNewSession() {
                this.sessionId = this.generateSessionId();
                this.sessionStartTime = Date.now();
                this.sessionExpiryTime = this.sessionStartTime + (3 * 60 * 60 * 1000); // 3 hours
                
                // Save session data
                const today = new Date().toDateString();
                let userSessions = JSON.parse(localStorage.getItem('vieusUserSessions')) || {};
                if (!userSessions[this.userId]) userSessions[this.userId] = {};
                if (!userSessions[this.userId][today]) userSessions[this.userId][today] = { active: [], completed: [] };
                
                const session = {
                    id: this.sessionId,
                    startTime: this.sessionStartTime,
                    expiryTime: this.sessionExpiryTime,
                    userAgent: navigator.userAgent
                };
                
                userSessions[this.userId][today].active.push(session);
                localStorage.setItem('vieusUserSessions', JSON.stringify(userSessions));
                
                // Update global stats
                this.updateGlobalStats();
                
                // Clear the "modal seen" flag when creating a new session
                localStorage.removeItem('vieusGuestModalSeen');
                
                return this.sessionId;
            }
            
            updateGlobalStats() {
                const today = new Date().toDateString();
                let globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                
                if (!globalData.dailyStats) globalData.dailyStats = {};
                if (!globalData.dailyStats[today]) globalData.dailyStats[today] = { 
                    uniqueVisitors: new Set(),
                    totalSessions: 0,
                    activeSessions: 0
                };
                
                // Convert Set to Array for JSON storage
                const visitorsSet = globalData.dailyStats[today].uniqueVisitors;
                if (visitorsSet instanceof Set) {
                    globalData.dailyStats[today].uniqueVisitors = Array.from(visitorsSet);
                }
                
                // Add current user to today's visitors
                if (!globalData.dailyStats[today].uniqueVisitors.includes(this.userId)) {
                    globalData.dailyStats[today].uniqueVisitors.push(this.userId);
                }
                
                // Count active sessions
                let activeSessionsCount = 0;
                const userSessions = JSON.parse(localStorage.getItem('vieusUserSessions')) || {};
                Object.values(userSessions).forEach(userData => {
                    Object.values(userData).forEach(dayData => {
                        if (dayData.active) {
                            activeSessionsCount += dayData.active.filter(s => s.expiryTime > Date.now()).length;
                        }
                    });
                });
                
                globalData.dailyStats[today].activeSessions = activeSessionsCount;
                globalData.dailyStats[today].totalSessions = (globalData.dailyStats[today].totalSessions || 0) + 1;
                
                localStorage.setItem('vieusGlobalData', JSON.stringify(globalData));
            }
            
            restartSession() {
                this.endSession(); // Clean up old session first
                const newSessionId = this.createNewSession();
                this.userData = this.getUserData();
                return { userId: this.userId, sessionId: newSessionId };
            }
            
            endSession() {
                if (!this.sessionId || !this.userId) return;
                
                const today = new Date().toDateString();
                let userSessions = JSON.parse(localStorage.getItem('vieusUserSessions')) || {};
                
                if (userSessions[this.userId] && userSessions[this.userId][today] && userSessions[this.userId][today].active) {
                    const activeSessions = userSessions[this.userId][today].active;
                    const idx = activeSessions.findIndex(s => s.id === this.sessionId);
                    
                    if (idx !== -1) {
                        const session = activeSessions.splice(idx, 1)[0];
                        session.endTime = Date.now();
                        session.duration = session.endTime - session.startTime;
                        
                        if (!userSessions[this.userId][today].completed) {
                            userSessions[this.userId][today].completed = [];
                        }
                        userSessions[this.userId][today].completed.push(session);
                        
                        // Update user stats
                        let globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                        if (globalData.users && globalData.users[this.userId]) {
                            globalData.users[this.userId].lastSeen = Date.now();
                            globalData.users[this.userId].totalSessions = (globalData.users[this.userId].totalSessions || 0) + 1;
                            globalData.users[this.userId].totalSessionTime = (globalData.users[this.userId].totalSessionTime || 0) + session.duration;
                        }
                        localStorage.setItem('vieusGlobalData', JSON.stringify(globalData));
                        
                        localStorage.setItem('vieusUserSessions', JSON.stringify(userSessions));
                    }
                }
                
                // Reset session data (keep userId)
                this.sessionId = null;
                this.sessionStartTime = null;
                this.sessionExpiryTime = null;
            }
            
            getUserData() {
                const today = new Date().toDateString();
                const globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                
                return {
                    userId: this.userId,
                    sessionId: this.sessionId,
                    userStats: globalData.users?.[this.userId] || {},
                    dailyStats: globalData.dailyStats?.[today] || { uniqueVisitors: [], totalSessions: 0, activeSessions: 0 }
                };
            }
            
            getTotalUniqueUsers() {
                const globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                return Object.keys(globalData.users || {}).length;
            }
            
            getTodayUniqueVisitors() {
                const today = new Date().toDateString();
                const globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                const todayData = globalData.dailyStats?.[today] || { uniqueVisitors: [] };
                
                if (Array.isArray(todayData.uniqueVisitors)) {
                    return todayData.uniqueVisitors.length;
                }
                return 0;
            }
            
            getActiveSessionsCount() {
                const today = new Date().toDateString();
                const globalData = JSON.parse(localStorage.getItem('vieusGlobalData')) || {};
                const todayData = globalData.dailyStats?.[today] || { activeSessions: 0 };
                return todayData.activeSessions || 0;
            }
            
            updateSessionTimer() {
                if (!this.sessionExpiryTime) {
                    this.showSessionExpiredModal();
                    return '00:00:00';
                }
                
                const remaining = this.sessionExpiryTime - Date.now();
                if (remaining <= 0) { 
                    this.showSessionExpiredModal();
                    return '00:00:00'; 
                }
                
                const h = Math.floor(remaining / (1000 * 60 * 60));
                const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((remaining % (1000 * 60)) / 1000);
                return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            }
            
            showSessionExpiredModal() {
                const expiredModal = document.getElementById('sessionExpiredModal');
                const expiredUserId = document.getElementById('expiredUserId');
                const expiredSessionId = document.getElementById('expiredSessionId');
                const expiredTotalUsers = document.getElementById('expiredTotalUsers');
                const expiredDailyVisitors = document.getElementById('expiredDailyVisitors');
                
                if (expiredModal) {
                    if (expiredUserId) expiredUserId.textContent = this.userId || 'USR-XXXX';
                    if (expiredSessionId) expiredSessionId.textContent = this.sessionId || 'SES-XXXX';
                    if (expiredTotalUsers) expiredTotalUsers.textContent = this.getTotalUniqueUsers();
                    if (expiredDailyVisitors) expiredDailyVisitors.textContent = this.getTodayUniqueVisitors();
                    
                    expiredModal.style.display = 'flex';
                    
                    // Clear content when session expires
                    if (liveContainer) liveContainer.innerHTML = '';
                    if (upcomingContainer) upcomingContainer.innerHTML = '';
                }
            }
            
            hideSessionExpiredModal() {
                const expiredModal = document.getElementById('sessionExpiredModal');
                if (expiredModal) {
                    expiredModal.style.display = 'none';
                }
            }
            
            addNotification(title, message, matchData = null) {
                const notif = { 
                    id: Date.now() + Math.random(), 
                    title, 
                    message, 
                    timestamp: Date.now(), 
                    matchData, 
                    expiryTime: matchData ? new Date(matchData.parsed_datetime || matchData.date_time).getTime() + (2.5 * 60 * 60 * 1000) : Date.now() + (30 * 60 * 1000) 
                };
                this.notifications.push(notif);
                
                // Store notification with user ID
                const today = new Date().toDateString();
                let userNotifications = JSON.parse(localStorage.getItem('vieusUserNotifications')) || {};
                if (!userNotifications[this.userId]) userNotifications[this.userId] = {};
                if (!userNotifications[this.userId][today]) userNotifications[this.userId][today] = [];
                
                if (!userNotifications[this.userId][today].some(n => n.id === notif.id)) {
                    userNotifications[this.userId][today].push(notif);
                    localStorage.setItem('vieusUserNotifications', JSON.stringify(userNotifications));
                }
                
                return notif;
            }
            
            getActiveNotifications() {
                const now = Date.now();
                this.notifications = this.notifications.filter(n => n.expiryTime > now);
                
                // Load from storage
                const today = new Date().toDateString();
                const userNotifications = JSON.parse(localStorage.getItem('vieusUserNotifications')) || {};
                const userTodayNotifications = userNotifications[this.userId]?.[today] || [];
                
                const stored = userTodayNotifications.filter(n => n.expiryTime > now);
                this.notifications = [...new Map([...this.notifications, ...stored].map(n => [n.id, n])).values()];
                
                return this.notifications;
            }
            
            cleanupExpiredNotifications() {
                const now = Date.now();
                this.notifications = this.notifications.filter(n => n.expiryTime > now);
            }
            
            showNotification(title, message, isReminder = true) {
                const key = `${title}-${message}-${this.userId}`;
                if (this.activeNotifications.has(key)) return;
                this.activeNotifications.add(key);
                
                const bar = document.getElementById('notificationBar');
                if (!bar) return;
                
                document.getElementById('notificationTitle').textContent = title;
                document.getElementById('notificationMessage').textContent = message;
                bar.style.display = 'flex';
                setTimeout(() => bar.classList.add('show'), 10);
                setTimeout(() => { 
                    this.hideNotification(); 
                    this.activeNotifications.delete(key); 
                }, isReminder ? 5000 : 7000);
            }
            
            hideNotification() {
                const bar = document.getElementById('notificationBar');
                if (!bar) return;
                bar.classList.remove('show');
                setTimeout(() => bar.style.display = 'none', 500);
            }
            
            formatTime(date) {
                if (!date) return 'TBD';
                const d = new Date(date);
                return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) + ' ' + d.toLocaleDateString([], { month: 'short', day: 'numeric' });
            }
        }

        /* ===== MAIN APPLICATION ===== */
        const API_BASE_URL = 'https://vieus-app.onrender.com';
        let allMatches = [], filteredMatches = [], currentView = 'home', currentModalMatch = null, 
            userReminders = JSON.parse(localStorage.getItem('vieusReminders')) || [], countdownTimers = {}, 
            userSessionManager = null;

        /* Premier League teams for importance filter */
        const PREMIER_LEAGUE_TEAMS = ["arsenal","aston villa","bournemouth","afc bournemouth","brentford","brighton & hove albion","brighton","chelsea","crystal palace","everton","fulham","ipswich town","ipswich","leicester city","leicester","liverpool","manchester city","man city","manchester united","man united","newcastle united","newcastle","nottingham forest","southampton","tottenham hotspur","tottenham","west ham united","west ham","wolverhampton wanderers","wolves"];

        /* Teams to exclude (junior and women teams) */
        const EXCLUDED_TEAM_KEYWORDS = [
            // Women's teams
            'women', 'ladies', 'feminino', 'feminine', 'femenino', 'féminin',
            // Junior/U teams
            'u19', 'u21', 'u23', 'under-19', 'under-21', 'under-23',
            'youth', 'junior', 'academy', 'reserves', 'b team',
            'u18', 'u17', 'u16', 'under-18', 'under-17', 'under-16',
            'development', 'second team'
        ];

        /* competition importance lookup - UPDATED to prioritize senior men's leagues */
        const COMPETITION_RANKING = {
            "premier league": { rank: 1, icon: "fas fa-crown", color: "#3d195b", hot: true, displayName: "English Premier League", isSeniorMen: true },
            "uefa champions league": { rank: 2, icon: "fas fa-trophy", color: "#ffd700", hot: true, displayName: "UEFA Champions League", isSeniorMen: true },
            "la liga": { rank: 3, icon: "fas fa-futbol", color: "#ff0000", hot: true, displayName: "La Liga", isSeniorMen: true },
            "bundesliga": { rank: 4, icon: "fas fa-shield-alt", color: "#dd0000", hot: true, displayName: "Bundesliga", isSeniorMen: true },
            "serie a": { rank: 5, icon: "fas fa-flag", color: "#008c45", hot: true, displayName: "Serie A", isSeniorMen: true },
            "ligue 1": { rank: 6, icon: "fas fa-star", color: "#0d5eaf", hot: true, displayName: "Ligue 1", isSeniorMen: true },
            "europa league": { rank: 7, icon: "fas fa-trophy", color: "#ff6b00", hot: true, displayName: "UEFA Europa League", isSeniorMen: true },
            "europa conference league": { rank: 8, icon: "fas fa-medal", color: "#00a8e0", displayName: "UEFA Conference League", isSeniorMen: true },
            "world cup": { rank: 9, icon: "fas fa-globe", color: "#1e90ff", displayName: "FIFA World Cup", isSeniorMen: true },
            "euro": { rank: 10, icon: "fas fa-globe-europe", color: "#0047ab", displayName: "UEFA European Championship", isSeniorMen: true },
            "copa america": { rank: 11, icon: "fas fa-globe-americas", color: "#ffcc00", displayName: "Copa America", isSeniorMen: true },
            "african cup of nations": { rank: 12, icon: "fas fa-globe-africa", color: "#008000", displayName: "Africa Cup of Nations", isSeniorMen: true },
            "asian cup": { rank: 13, icon: "fas fa-globe-asia", color: "#ff0000", displayName: "AFC Asian Cup", isSeniorMen: true },
            "fa cup": { rank: 14, icon: "fas fa-cup", color: "#ff0000", displayName: "FA Cup", isSeniorMen: true },
            "copa del rey": { rank: 15, icon: "fas fa-crown", color: "#ffcc00", displayName: "Copa del Rey", isSeniorMen: true },
            "dfb-pokal": { rank: 16, icon: "fas fa-trophy", color: "#000000", displayName: "DFB-Pokal", isSeniorMen: true },
            "coppa italia": { rank: 17, icon: "fas fa-flag", color: "#008c45", displayName: "Coppa Italia", isSeniorMen: true },
            "coupe de france": { rank: 18, icon: "fas fa-wine-glass-alt", color: "#0055a4", displayName: "Coupe de France", isSeniorMen: true },
            "carabao cup": { rank: 19, icon: "fas fa-mug-hot", color: "#f4a300", displayName: "Carabao Cup", isSeniorMen: true },
            "community shield": { rank: 20, icon: "fas fa-shield", color: "#ff6b6b", displayName: "Community Shield", isSeniorMen: true },
            "eredivisie": { rank: 21, icon: "fas fa-futbol", color: "#ff6b35", displayName: "Eredivisie", isSeniorMen: true },
            "primeira liga": { rank: 22, icon: "fas fa-futbol", color: "#006600", displayName: "Primeira Liga", isSeniorMen: true },
            "scottish premiership": { rank: 23, icon: "fas fa-futbol", color: "#003399", displayName: "Scottish Premiership", isSeniorMen: true },
            "belgian pro league": { rank: 24, icon: "fas fa-futbol", color: "#ff0000", displayName: "Belgian Pro League", isSeniorMen: true },
            "championship": { rank: 30, icon: "fas fa-arrow-up", color: "#0d5eaf", displayName: "EFL Championship", isSeniorMen: true },
            "league one": { rank: 31, icon: "fas fa-chevron-up", color: "#ff6b00", displayName: "EFL League One", isSeniorMen: true },
            "league two": { rank: 32, icon: "fas fa-chevron-double-up", color: "#800080", displayName: "EFL League Two", isSeniorMen: true },
            "segunda division": { rank: 33, icon: "fas fa-arrow-down", color: "#ff0000", displayName: "La Liga 2", isSeniorMen: true },
            "2. bundesliga": { rank: 34, icon: "fas fa-arrow-down", color: "#990000", displayName: "2. Bundesliga", isSeniorMen: true },
            "serie b": { rank: 35, icon: "fas fa-arrow-down", color: "#006600", displayName: "Serie B", isSeniorMen: true },
            "u21": { rank: 40, icon: "fas fa-user-friends", color: "#00cc99", displayName: "U21 Matches", isSeniorMen: false },
            "u19": { rank: 41, icon: "fas fa-user-friends", color: "#00aa77", displayName: "U19 Matches", isSeniorMen: false },
            "u23": { rank: 42, icon: "fas fa-user-friends", color: "#008855", displayName: "U23 Matches", isSeniorMen: false },
            "women": { rank: 43, icon: "fas fa-venus", color: "#ff66b2", displayName: "Women's Football", isSeniorMen: false },
            "friendly": { rank: 50, icon: "fas fa-handshake", color: "#999999", displayName: "Friendly Matches", isSeniorMen: true },
            "other": { rank: 999, icon: "fas fa-futbol", color: "#cccccc", hot: false, isSeniorMen: true }
        };

        /* ----------  DOM SHORTCUTS  ---------- */
        const guestModal = document.getElementById('guestModal'), guestTimer = document.getElementById('guestTimer'), guestTimerLarge = document.getElementById('guestTimerLarge'),
              userIdDisplay = document.getElementById('userIdDisplay'), sessionIdDisplay = document.getElementById('sessionIdDisplay'), 
              sessionStartTime = document.getElementById('sessionStartTime'), sessionExpiryTime = document.getElementById('sessionExpiryTime'),
              totalUsers = document.getElementById('totalUsers'), dailyVisitors = document.getElementById('dailyVisitors'), 
              visitCounter = document.getElementById('visitCounter'), uniqueUserCount = document.getElementById('uniqueUserCount'), 
              dailyVisitorCount = document.getElementById('dailyVisitorCount'), continueBtn = document.getElementById('continueBtn'), 
              liveContainer = document.getElementById('liveContainer'), upcomingContainer = document.getElementById('upcomingContainer'),
              backBtn = document.getElementById('backBtn'), sectionTitle = document.getElementById('sectionTitle'), refreshBtn = document.getElementById('refreshBtn'),
              dockItems = document.querySelectorAll('.dock-item'), matchModal = document.getElementById('matchModal'), modalClose = document.getElementById('modalClose'),
              streamsList = document.getElementById('streamsList'), modalStreams = document.getElementById('modalStreams'), modalReminderBtn = document.getElementById('modalReminderBtn'),
              modalWatchBtn = document.getElementById('modalWatchBtn'), searchBar = document.getElementById('searchBar'), searchBtn = document.getElementById('searchBtn'),
              notificationBar = document.getElementById('notificationBar'), notificationTitle = document.getElementById('notificationTitle'), notificationMessage = document.getElementById('notificationMessage'),
              notificationClose = document.getElementById('notificationClose'), sessionExpiredModal = document.getElementById('sessionExpiredModal'),
              restartSessionBtn = document.getElementById('restartSessionBtn'), closeExpiredModal = document.getElementById('closeExpiredModal');

        /* ----------  INITIALISATION  ---------- */
        document.addEventListener('DOMContentLoaded', () => { 
            initializeUserSystem(); 
            setupEventListeners(); 
        });

        function initializeUserSystem() {
            userSessionManager = new UserSessionManager();
            updateGuestModalInfo();
            updateVisitorStats();
            startSessionTimer();
            
            // Show welcome notification after a short delay
            setTimeout(() => {
                if (userSessionManager.userId && userSessionManager.sessionId) {
                    userSessionManager.showNotification('Welcome!', `Your 3-hour session has started. User ID: ${userSessionManager.userId}`);
                }
            }, 1000);
            
            // Check if we should show the guest modal
            const hasSeenModal = localStorage.getItem('vieusGuestModalSeen');
            if (!hasSeenModal && userSessionManager.sessionId) {
                guestModal.style.display = 'flex';
                localStorage.setItem('vieusGuestModalSeen', 'true');
            } else {
                guestModal.style.display = 'none';
                loadData();
            }
        }
        
        function updateGuestModalInfo() {
            if (!userSessionManager.userId) return;
            
            if (userIdDisplay) userIdDisplay.textContent = userSessionManager.userId;
            if (sessionIdDisplay) sessionIdDisplay.textContent = userSessionManager.sessionId || 'SES-XXXX';
            if (guestTimer) guestTimer.textContent = '03:00:00';
            if (guestTimerLarge) guestTimerLarge.textContent = '03:00:00';
            
            if (userSessionManager.sessionStartTime && sessionStartTime) {
                sessionStartTime.textContent = userSessionManager.formatTime(userSessionManager.sessionStartTime);
            }
            
            if (userSessionManager.sessionExpiryTime && sessionExpiryTime) {
                sessionExpiryTime.textContent = userSessionManager.formatTime(userSessionManager.sessionExpiryTime);
            }
            
            if (totalUsers) totalUsers.textContent = userSessionManager.getTotalUniqueUsers();
            if (dailyVisitors) dailyVisitors.textContent = userSessionManager.getTodayUniqueVisitors();
        }

        function startSessionTimer() {
            setInterval(() => {
                if (userSessionManager && userSessionManager.userId) {
                    const timeLeft = userSessionManager.updateSessionTimer();
                    if (guestTimer) guestTimer.textContent = timeLeft;
                    if (guestTimerLarge) guestTimerLarge.textContent = timeLeft;
                    
                    if (Math.floor(Date.now() / 1000) % 30 === 0) updateVisitorStats();
                    if (Math.floor(Date.now() / 1000) % 60 === 0) userSessionManager.cleanupExpiredNotifications();
                    if (Math.floor(Date.now() / 1000) % 30 === 0) checkUpcomingReminders();
                }
            }, 1000);
        }

        function updateVisitorStats() {
            if (!userSessionManager) return;
            
            const totalUsers = userSessionManager.getTotalUniqueUsers();
            const todayVisitors = userSessionManager.getTodayUniqueVisitors();
            const activeSessions = userSessionManager.getActiveSessionsCount();
            
            if (uniqueUserCount) uniqueUserCount.textContent = totalUsers;
            if (dailyVisitorCount) dailyVisitorCount.textContent = todayVisitors;
            
            if (visitCounter) {
                visitCounter.innerHTML = `<i class="fas fa-users"></i> ${totalUsers} users <span style="margin-left:10px">${todayVisitors} today</span>`;
            }
        }
        
        function restartUserSession() {
            if (!userSessionManager) return;
            
            const newSession = userSessionManager.restartSession();
            updateGuestModalInfo();
            updateVisitorStats();
            
            // Hide expired modal
            userSessionManager.hideSessionExpiredModal();
            
            // Show guest modal for new session
            guestModal.style.display = 'flex';
            
            // Show notification
            userSessionManager.showNotification('Session Restarted', `New 3-hour session started. Session ID: ${newSession.sessionId}`);
            
            // Load data after a short delay
            setTimeout(() => {
                guestModal.style.display = 'none';
                loadData();
            }, 1000);
        }

        /* ----------  COUNTDOWN  ---------- */
        function updateCountdown(matchId, startTime) {
            const now = new Date();
            const matchDate = new Date((d => d.setHours(d.getHours() - 1))(new Date(startTime)) || startTime);
            if (isNaN(matchDate.getTime())) return "Invalid time";
            const diff = matchDate.getTime() - now.getTime();
            if (diff <= 0) {
                if (countdownTimers[matchId]) { clearInterval(countdownTimers[matchId]); delete countdownTimers[matchId]; }
                return "Match Started";
            }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            return days > 0 ? `${days}d ${hours}h ${minutes}m` : hours > 0 ? `${hours}h ${minutes}m ${seconds}s` : `${minutes}m ${seconds}s`;
        }

        function startCountdownTimers() {
            document.querySelectorAll('.match-card.upcoming').forEach(card => {
                const matchId = card.dataset.matchId, startTime = card.dataset.startTime;
                if (!matchId || !startTime) return;
                if (countdownTimers[matchId]) clearInterval(countdownTimers[matchId]);
                const el = card.querySelector('.countdown-timer');
                if (el) el.textContent = updateCountdown(matchId, startTime);
                countdownTimers[matchId] = setInterval(() => {
                    const e = card.querySelector('.countdown-timer');
                    if (e) {
                        const t = updateCountdown(matchId, startTime);
                        e.textContent = t;
                        if (t === "Match Started") { clearInterval(countdownTimers[matchId]); delete countdownTimers[matchId]; }
                    }
                }, 1000);
            });
        }

        /* ----------  DATA FILTERING FUNCTIONS  ---------- */
        function isSeniorMenTeam(teamName) {
            if (!teamName) return false;
            const nameLower = teamName.toLowerCase();
            // Check for excluded keywords
            return !EXCLUDED_TEAM_KEYWORDS.some(keyword => nameLower.includes(keyword));
        }

        function isSeniorMenCompetition(competitionName) {
            if (!competitionName) return true; // Default to true if unknown
            const compLower = competitionName.toLowerCase();
            const imp = getCompetitionImportanceFromName(compLower);
            return imp.isSeniorMen !== false;
        }

        function getCompetitionImportanceFromName(competitionName) {
            if (!competitionName) return COMPETITION_RANKING["other"];
            const comp = competitionName.toLowerCase();
            if (comp.includes("premier league")) return COMPETITION_RANKING["premier league"];
            if (comp.includes("champions league")) return COMPETITION_RANKING["uefa champions league"];
            if (comp.includes("europa league")) return COMPETITION_RANKING["europa league"];
            if (comp.includes("conference league")) return COMPETITION_RANKING["europa conference league"];
            if (comp.includes("la liga") && !comp.includes("2")) return COMPETITION_RANKING["la liga"];
            if (comp.includes("bundesliga") && !comp.includes("2.")) return COMPETITION_RANKING["bundesliga"];
            if (comp.includes("serie a") && !comp.includes("b")) return COMPETITION_RANKING["serie a"];
            if (comp.includes("ligue 1")) return COMPETITION_RANKING["ligue 1"];
            if (comp.includes("fa cup")) return COMPETITION_RANKING["fa cup"];
            if (comp.includes("carabao")) return COMPETITION_RANKING["carabao cup"];
            if (comp.includes("eredivisie")) return COMPETITION_RANKING["eredivisie"];
            if (comp.includes("primeira")) return COMPETITION_RANKING["primeira liga"];
            if (comp.includes("scottish")) return COMPETITION_RANKING["scottish premiership"];
            if (comp.includes("belgian")) return COMPETITION_RANKING["belgian pro league"];
            if (comp.includes("championship")) return COMPETITION_RANKING["championship"];
            if (comp.includes("league 1") || comp.includes("league one")) return COMPETITION_RANKING["league one"];
            if (comp.includes("league 2") || comp.includes("league two")) return COMPETITION_RANKING["league two"];
            if (comp.includes("segunda") || comp.includes("la liga 2")) return COMPETITION_RANKING["segunda division"];
            if (comp.includes("2. bundesliga")) return COMPETITION_RANKING["2. bundesliga"];
            if (comp.includes("serie b")) return COMPETITION_RANKING["serie b"];
            if (comp.includes("u21") || comp.includes("under-21")) return COMPETITION_RANKING["u21"];
            if (comp.includes("u19") || comp.includes("under-19")) return COMPETITION_RANKING["u19"];
            if (comp.includes("u23") || comp.includes("under-23")) return COMPETITION_RANKING["u23"];
            if (comp.includes("women")) return COMPETITION_RANKING["women"];
            if (comp.includes("friendly")) return COMPETITION_RANKING["friendly"];
            return COMPETITION_RANKING["other"];
        }

        /* ----------  DATA LOADING  ---------- */
        async function loadData() {
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            try {
                showLoading();
                const res = await fetch(API_BASE_URL);
                if (!res.ok) throw new Error('Network response failed');
                const data = await res.json();
                
                // Apply all filters
                allMatches = data.filter(m => {
                    const homeTeam = getTeamName(m, 0), awayTeam = getTeamName(m, 1);
                    const homeLogo = getTeamLogo(m, 0), awayLogo = getTeamLogo(m, 1);
                    
                    // 1. Basic validation
                    const validName = t => t && t.trim() !== '' && !/^\d+$/.test(t.replace(/\s/g, '')) && t !== 'Home Team' && t !== 'Away Team' && t.length > 2 && !t.toLowerCase().includes('undefined');
                    const validLogo = l => l && l.trim() !== '' && l !== 'null' && l !== 'undefined' && !l.includes('placeholder');
                    
                    if (!validName(homeTeam) || !validName(awayTeam) || !validLogo(homeLogo) || !validLogo(awayLogo)) {
                        return false;
                    }
                    
                    // 2. Check if both teams are senior men's teams
                    const isHomeSenior = isSeniorMenTeam(homeTeam);
                    const isAwaySenior = isSeniorMenTeam(awayTeam);
                    
                    if (!isHomeSenior || !isAwaySenior) {
                        return false;
                    }
                    
                    // 3. Check if competition is senior men's (optional but good to have)
                    const isCompSenior = isSeniorMenCompetition(m.competition);
                    
                    return isCompSenior;
                });
                
                filteredMatches = [...allMatches];
                renderAllMatches();
            } catch (e) { 
                console.error(e); 
                showError(); 
            }
        }
        
        function showSessionExpired() {
            const html = `<div style="text-align:center;padding:40px;color:var(--text-gray)">
                <i class="fas fa-hourglass-end fa-2x" style="color:var(--wine-red)"></i>
                <h3 style="color:var(--text-light);margin:15px 0 10px">Session Expired</h3>
                <p>Your 3-hour guest session has ended. Please start a new session to continue.</p>
                <button class="watch-btn" onclick="restartUserSession()" style="margin-top:20px;width:auto;padding:10px 30px">
                    <i class="fas fa-redo"></i> START NEW SESSION
                </button>
            </div>`;
            if (liveContainer) liveContainer.innerHTML = html; 
            if (upcomingContainer) upcomingContainer.innerHTML = html;
        }

        function showLoading() {
            const html = `<div style="text-align:center;padding:40px;color:var(--text-gray)"><i class="fas fa-spinner fa-spin fa-2x"></i><p style="margin-top:15px">Loading matches...</p></div>`;
            if (liveContainer) liveContainer.innerHTML = html; 
            if (upcomingContainer) upcomingContainer.innerHTML = html;
        }
        
        function showError() {
            const html = `<div style="text-align:center;padding:40px;color:var(--text-gray)"><i class="fas fa-exclamation-triangle fa-2x"></i><h3 style="color:var(--text-light);margin:15px 0 10px">Connection Error</h3><p>Unable to load matches. Please try again later.</p><button class="watch-btn" onclick="loadData()" style="margin-top:20px;width:auto;padding:10px 30px"><i class="fas fa-redo"></i> Retry</button></div>`;
            if (liveContainer) liveContainer.innerHTML = html; 
            if (upcomingContainer) upcomingContainer.innerHTML = html;
        }

        /* ----------  SEARCH  ---------- */
        function performSearch() {
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            const term = searchBar.value.toLowerCase().trim();
            filteredMatches = !term ? [...allMatches] : allMatches.filter(m => {
                const home = getTeamName(m, 0).toLowerCase(), away = getTeamName(m, 1).toLowerCase(), comp = (m.competition || '').toLowerCase();
                return home.includes(term) || away.includes(term) || comp.includes(term);
            });
            renderAllMatches();
        }

        /* ----------  COMPETITION IMPORTANCE  ---------- */
        function getCompetitionImportance(match) {
            const comp = (match.competition || '').toLowerCase();
            const home = getTeamName(match, 0).toLowerCase(), away = getTeamName(match, 1).toLowerCase();
            if (comp.includes("premier league")) {
                const isHome = PREMIER_LEAGUE_TEAMS.some(t => home.includes(t) || t.includes(home));
                const isAway = PREMIER_LEAGUE_TEAMS.some(t => away.includes(t) || t.includes(away));
                if (isHome && isAway) return COMPETITION_RANKING["premier league"];
            }
            for (const [key, val] of Object.entries(COMPETITION_RANKING)) {
                if (key === "premier league" || key === "other") continue;
                if (comp.includes(key)) return val;
            }
            if (comp.includes("champions league")) return COMPETITION_RANKING["uefa champions league"];
            if (comp.includes("europa league")) return COMPETITION_RANKING["europa league"];
            if (comp.includes("conference league")) return COMPETITION_RANKING["europa conference league"];
            if (comp.includes("fa cup")) return COMPETITION_RANKING["fa cup"];
            if (comp.includes("carabao")) return COMPETITION_RANKING["carabao cup"];
            if (comp.includes("community shield")) return COMPETITION_RANKING["community shield"];
            if (comp.includes("eredivisie")) return COMPETITION_RANKING["eredivisie"];
            if (comp.includes("primeira")) return COMPETITION_RANKING["primeira liga"];
            if (comp.includes("scottish")) return COMPETITION_RANKING["scottish premiership"];
            if (comp.includes("belgian")) return COMPETITION_RANKING["belgian pro league"];
            if (comp.includes("championship")) return COMPETITION_RANKING["championship"];
            if (comp.includes("league 1") || comp.includes("league one")) return COMPETITION_RANKING["league one"];
            if (comp.includes("league 2") || comp.includes("league two")) return COMPETITION_RANKING["league two"];
            if (comp.includes("segunda")) return COMPETITION_RANKING["segunda division"];
            if (comp.includes("2. bundesliga")) return COMPETITION_RANKING["2. bundesliga"];
            if (comp.includes("serie b")) return COMPETITION_RANKING["serie b"];
            if (comp.includes("u21") || comp.includes("under-21")) return COMPETITION_RANKING["u21"];
            if (comp.includes("u19") || comp.includes("under-19")) return COMPETITION_RANKING["u19"];
            if (comp.includes("u23") || comp.includes("under-23")) return COMPETITION_RANKING["u23"];
            if (comp.includes("women")) return COMPETITION_RANKING["women"];
            if (comp.includes("friendly")) return COMPETITION_RANKING["friendly"];
            return COMPETITION_RANKING["other"];
        }

        /* ----------  RENDER  ---------- */
        function groupMatchesByImportance(matches, isLive) {
            const grouped = {};
            matches.forEach(m => {
                const imp = getCompetitionImportance(m);
                const key = imp.displayName || m.competition || "Other Matches";
                if (!grouped[key]) grouped[key] = { 
                    competition: m.competition || "Other Matches", 
                    displayName: key, 
                    matches: [], 
                    importance: imp.rank, 
                    icon: imp.icon, 
                    color: imp.color, 
                    hot: imp.hot || false,
                    isSeniorMen: imp.isSeniorMen !== false
                };
                grouped[key].matches.push(m);
            });
            
            // Sort: senior men's leagues first, then by importance
            return Object.values(grouped).sort((a, b) => {
                // Senior men's leagues come first
                if (a.isSeniorMen && !b.isSeniorMen) return -1;
                if (!a.isSeniorMen && b.isSeniorMen) return 1;
                // Then by importance rank
                return a.importance - b.importance;
            });
        }
        
        function renderAllMatches() {
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            const live = filteredMatches.filter(m => m.is_live), upcoming = filteredMatches.filter(m => !m.is_live);
            renderMatchesByImportance(liveContainer, live, true);
            renderMatchesByImportance(upcomingContainer, upcoming, false);
            setTimeout(startCountdownTimers, 100);
        }
        
        function renderMatchesByImportance(container, matches, isLive) {
            if (!container) return;
            container.innerHTML = '';
            if (matches.length === 0) {
                container.innerHTML = `<div style="text-align:center;padding:40px;color:var(--text-gray)"><i class="fas fa-tv-slash fa-2x"></i><h3 style="color:var(--text-light);margin:15px 0 10px">${isLive ? 'No live matches at the moment' : 'No upcoming matches'}</h3><p>${searchBar.value ? 'Try a different search term' : 'Check back later for more matches'}</p></div>`;
                return;
            }
            const groups = groupMatchesByImportance(matches, isLive);
            groups.forEach(g => {
                if (g.matches.length === 0) return;
                const section = document.createElement('div');
                section.className = 'league-section';
                const header = document.createElement('div');
                header.className = 'league-header';
                header.style.borderLeftColor = g.color;
                header.onclick = () => section.classList.toggle('collapsed');
                if (g.hot) header.insertAdjacentHTML('afterbegin', '<div class="hot-indicator"></div>');
                header.innerHTML = `
                    <div class="league-header-content">
                        <div class="league-icon" style="background:${g.color}20"><i class="${g.icon}" style="color:${g.color}"></i></div>
                        <div class="league-name">${g.displayName}</div>
                    </div>
                    <div class="match-count" style="background:${g.color}">${g.matches.length} match${g.matches.length > 1 ? 'es' : ''}</div>
                `;
                const grid = document.createElement('div');
                grid.className = 'league-matches';
                g.matches.forEach(m => grid.appendChild(createMatchCard(m, isLive, g)));
                section.append(header, grid);
                container.appendChild(section);
            });
        }
        
        function createMatchCard(match, isLive, group) {
            const homeTeam = getTeamName(match, 0), awayTeam = getTeamName(match, 1), homeLogo = getTeamLogo(match, 0), awayLogo = getTeamLogo(match, 1);
            const time = formatTime(match.parsed_datetime || match.date_time), matchId = match.event_id || `${homeTeam}-${awayTeam}-${Date.now()}`, startTime = match.parsed_datetime || match.date_time;
            const card = document.createElement('div');
            card.className = `match-card ${isLive ? 'live' : 'upcoming'}`;
            card.dataset.matchId = matchId;
            card.dataset.startTime = startTime;
            card.innerHTML = `
                <div class="match-status ${isLive ? 'status-live' : 'status-upcoming'}">${isLive ? 'LIVE' : 'UPCOMING'}</div>
                <div class="match-info-header">
                    <div class="match-league">${group.displayName}</div>
                    <div class="match-time">${time}</div>
                </div>
                <div class="teams-display">
                    <div class="team">
                        <div class="team-logo"><img src="${homeLogo}" alt="${homeTeam}" onerror="this.src='https://via.placeholder.com/80/f8f8f8/333333?text=${homeTeam.substring(0,2).toUpperCase()}'"></div>
                        <div class="team-name">${homeTeam}</div>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="team">
                        <div class="team-logo"><img src="${awayLogo}" alt="${awayTeam}" onerror="this.src='https://via.placeholder.com/80/f8f8f8/333333?text=${awayTeam.substring(0,2).toUpperCase()}'"></div>
                        <div class="team-name">${awayTeam}</div>
                    </div>
                </div>
                ${!isLive ? `<div class="countdown-section"><div class="countdown-container"><span class="countdown-timer">${updateCountdown(matchId, startTime)}</span></div></div>` : ''}
                <div class="watch-btn-container"><button class="watch-btn"><i class="fas fa-eye"></i> PREVIEW</button></div>
            `;
            card.querySelector('.watch-btn').addEventListener('click', () => openPreview(match, group));
            return card;
        }

        /* ----------  PREVIEW MODAL  ---------- */
        function openPreview(match, group) {
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            currentModalMatch = match;
            const homeTeam = getTeamName(match, 0), awayTeam = getTeamName(match, 1), homeLogo = getTeamLogo(match, 0), awayLogo = getTeamLogo(match, 1);
            const time = formatTime(match.parsed_datetime || match.date_time), broadcastInfo = getBroadcastInfo(match);
            const displayCompetition = group ? group.displayName : match.competition, isHotCompetition = group ? group.hot : false;
            document.getElementById('modalTitle').textContent = `${homeTeam} vs ${awayTeam}`;
            const modalCompetition = document.getElementById('modalCompetition');
            modalCompetition.textContent = displayCompetition;
            if (isHotCompetition) modalCompetition.innerHTML = `${displayCompetition} <span style="color:var(--hot-color);margin-left:10px"><i class="fas fa-fire"></i> HOT</span>`;
            document.getElementById('modalTeams').innerHTML = `
                <div class="modal-team"><div class="modal-team-logo"><img src="${homeLogo}" onerror="this.src='https://via.placeholder.com/140/f8f8f8/333333?text=${homeTeam.substring(0,2).toUpperCase()}'"></div><div class="modal-team-name">${homeTeam}</div></div>
                <div class="modal-vs">VS</div>
                <div class="modal-team"><div class="modal-team-logo"><img src="${awayLogo}" onerror="this.src='https://via.placeholder.com/140/f8f8f8/333333?text=${awayTeam.substring(0,2).toUpperCase()}'"></div><div class="modal-team-name">${awayTeam}</div></div>
            `;
            document.getElementById('modalInfoStrip').innerHTML = `
                <div class="info-item"><i class="far fa-calendar"></i><span>${time}</span></div>
                <div class="info-item"><i class="fas fa-circle" style="color:${match.is_live ? '#ffcc00' : 'var(--cyan)'}"></i><span>${match.is_live ? 'LIVE' : 'UPCOMING'}</span></div>
                <div class="info-item"><i class="fas fa-globe"></i><span>${broadcastInfo}</span></div>
            `;
            populateStreamLinks(match);
            const isReminded = userReminders.some(r => r.event_id === match.event_id);
            modalReminderBtn.innerHTML = isReminded ? '<i class="fas fa-bell-slash"></i> REMOVE REMINDER' : '<i class="far fa-bell"></i> SET REMINDER';
            matchModal.classList.add('active'); document.body.style.overflow = 'hidden';
        }
        
        function getBroadcastInfo(match) {
            if (match.streams && match.streams.length > 0) {
                const langs = [...new Set(match.streams.map(s => s.language).filter(Boolean))];
                return langs.length > 0 ? langs.join(', ') : 'Multiple languages';
            }
            return 'Check schedule';
        }
        
        function populateStreamLinks(match) {
            if (!match.streams || match.streams.length === 0) {
                streamsList.innerHTML = `<div class="no-streams"><i class="fas fa-tv-slash"></i><h4>No Streams Available</h4><p>Stream links will appear closer to match time</p></div>`;
                modalStreams.classList.remove('active'); return;
            }
            const available = match.streams.filter(s => s.stream_url && s.stream_url !== '#' && !s.stream_url.includes('livetv.sx'));
            if (available.length === 0) {
                streamsList.innerHTML = `<div class="no-streams"><i class="fas fa-exclamation-triangle"></i><h4>No Direct Streams</h4><p>Try the WATCH NOW button for alternative streaming options</p></div>`;
                modalStreams.classList.remove('active'); return;
            }
            streamsList.innerHTML = available.map((s, i) => {
                const lang = s.language || 'Unknown', qual = s.rating || s.bitrate || s.stream_type || 'HD', perc = s.rating ? s.rating.replace('%', '') : '95';
                return `
                    <div class="stream-item" onclick="window.open('${s.stream_url}', '_blank')">
                        <div class="stream-tv-icon"><i class="fas fa-tv"></i></div>
                        <div class="stream-watch-now">WATCH NOW</div>
                        <div class="stream-language">${lang} - ${qual}</div>
                        <div class="stream-quality">${perc}% Reliable</div>
                    </div>
                `;
            }).join('');
            modalStreams.classList.add('active');
        }
        
        function closeModal() { 
            matchModal.classList.remove('active'); 
            document.body.style.overflow = 'auto'; 
            currentModalMatch = null; 
        }
        
        function watchNow() {
            if (!currentModalMatch) return;
            
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            let url = null;
            if (currentModalMatch.streams && currentModalMatch.streams.length > 0) {
                const direct = currentModalMatch.streams.find(s => s.stream_url && s.stream_url !== '#' && !s.stream_url.includes('livetv.sx'));
                if (direct) url = direct.stream_url; else { const first = currentModalMatch.streams.find(s => s.stream_url && s.stream_url !== '#'); if (first) url = first.stream_url; }
            }
            if (url) { 
                window.open(url, '_blank'); 
                userSessionManager.showNotification('Stream Opening', 'The stream is opening in a new tab...', false); 
            }
            else userSessionManager.showNotification('No Direct Stream', 'Try clicking the individual stream links above', false);
        }

        /* ----------  REMINDERS  ---------- */
        function toggleReminder() {
            if (!currentModalMatch) return;
            
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            const idx = userReminders.findIndex(r => r.event_id === currentModalMatch.event_id);
            const home = getTeamName(currentModalMatch, 0), away = getTeamName(currentModalMatch, 1);
            if (idx === -1) {
                userReminders.push({ event_id: currentModalMatch.event_id, competition: currentModalMatch.competition, matchup: currentModalMatch.matchup, date_time: currentModalMatch.date_time, added: new Date().toISOString() });
                localStorage.setItem('vieusReminders', JSON.stringify(userReminders));
                userSessionManager.addNotification('Reminder Set!', `You'll be notified before ${home} vs ${away} starts`, currentModalMatch);
                userSessionManager.showNotification('Reminder Set!', `You'll be notified before ${home} vs ${away} starts`);
            } else {
                userReminders.splice(idx, 1);
                localStorage.setItem('vieusReminders', JSON.stringify(userReminders));
                userSessionManager.showNotification('Reminder Removed', `Reminder for ${home} vs ${away} has been removed`);
            }
            const isReminded = userReminders.some(r => r.event_id === currentModalMatch.event_id);
            modalReminderBtn.innerHTML = isReminded ? '<i class="fas fa-bell-slash"></i> REMOVE REMINDER' : '<i class="far fa-bell"></i> SET REMINDER';
        }
        
        function checkUpcomingReminders() {
            if (!userSessionManager || !userSessionManager.userId) return;
            
            const now = new Date();
            userReminders.forEach(r => {
                try {
                    const matchTime = new Date((d => d.setHours(d.getHours() - 1))(new Date(r.date_time)) || r.date_time);
                    if (isNaN(matchTime.getTime())) return;
                    const minutes = (matchTime.getTime() - now.getTime()) / (1000 * 60);
                    if (minutes > 0 && minutes <= 15) {
                        const key = `notified_${r.event_id}_${userSessionManager.userId}`;
                        if (!localStorage.getItem(key)) {
                            userSessionManager.showNotification('Match Starting Soon!', `${r.matchup} starts in ${Math.round(minutes)} minutes`, false);
                            localStorage.setItem(key, 'true');
                        }
                    }
                } catch (e) { console.error(e); }
            });
        }

        /* ----------  VIEW MANAGEMENT  ---------- */
        function switchView(view) {
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            currentView = view;
            dockItems.forEach(item => item.classList.toggle('active', item.dataset.view === view));
            switch (view) {
                case 'home':
                    backBtn.style.display = 'none';
                    sectionTitle.innerHTML = '<i class="fas fa-broadcast-tower"></i> Live Matches';
                    liveContainer.style.display = 'block';
                    upcomingContainer.style.display = 'block';
                    break;
                case 'live':
                    backBtn.style.display = 'flex';
                    sectionTitle.innerHTML = '<i class="fas fa-broadcast-tower"></i> Live Matches';
                    liveContainer.style.display = 'block';
                    upcomingContainer.style.display = 'none';
                    break;
                case 'upcoming':
                    backBtn.style.display = 'flex';
                    sectionTitle.innerHTML = '<i class="far fa-clock"></i> Upcoming Matches';
                    liveContainer.style.display = 'none';
                    upcomingContainer.style.display = 'block';
                    break;
                case 'account':
                    showAccountView();
                    break;
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function showAccountView() {
            // Check if session is valid
            if (!userSessionManager || !userSessionManager.userId || !userSessionManager.sessionId || 
                !userSessionManager.sessionExpiryTime || userSessionManager.sessionExpiryTime <= Date.now()) {
                showSessionExpired();
                return;
            }
            
            backBtn.style.display = 'flex';
            sectionTitle.innerHTML = '<i class="fas fa-user-circle"></i> Account';
            liveContainer.style.display = 'none';
            upcomingContainer.style.display = 'none';
            let accountView = document.getElementById('accountView');
            if (!accountView) {
                accountView = document.createElement('div');
                accountView.id = 'accountView';
                const sectionHeader = document.querySelector('.section-header');
                sectionHeader.parentNode.insertBefore(accountView, sectionHeader.nextSibling);
            }
            
            const userData = userSessionManager.getUserData();
            const totalUniqueUsers = userSessionManager.getTotalUniqueUsers();
            const todayUniqueVisitors = userSessionManager.getTodayUniqueVisitors();
            const activeSessions = userSessionManager.getActiveSessionsCount();
            
            accountView.innerHTML = `
                <div style="text-align:center;padding:40px;color:var(--text-gray)">
                    <div class="guest-stats" style="max-width:500px;margin:0 auto 30px">
                        <div class="stat-item"><span class="stat-label">Your User ID:</span><span class="stat-value">${userSessionManager.userId}</span></div>
                        <div class="stat-item"><span class="stat-label">Session ID:</span><span class="stat-value">${userSessionManager.sessionId || 'No active session'}</span></div>
                        <div class="stat-item"><span class="stat-label">Session Started:</span><span class="stat-value">${userSessionManager.formatTime(userSessionManager.sessionStartTime)}</span></div>
                        <div class="stat-item"><span class="stat-label">Session Expires:</span><span class="stat-value">${userSessionManager.formatTime(userSessionManager.sessionExpiryTime)}</span></div>
                        <div class="stat-item"><span class="stat-label">Time Remaining:</span><span class="stat-value" id="accountTimer">${guestTimer.textContent}</span></div>
                        <div class="stat-item"><span class="stat-label">Total Unique Users:</span><span class="stat-value">${totalUniqueUsers}</span></div>
                        <div class="stat-item"><span class="stat-label">Today's Unique Visitors:</span><span class="stat-value">${todayUniqueVisitors}</span></div>
                        <div class="stat-item"><span class="stat-label">Active Sessions Now:</span><span class="stat-value">${activeSessions}</span></div>
                        <div class="stat-item"><span class="stat-label">Your Total Sessions:</span><span class="stat-value">${userData.userStats.totalSessions || 0}</span></div>
                        <div class="stat-item"><span class="stat-label">First Seen:</span><span class="stat-value">${userSessionManager.formatTime(userData.userStats.firstSeen)}</span></div>
                        <div class="stat-item"><span class="stat-label">Last Seen:</span><span class="stat-value">${userSessionManager.formatTime(userData.userStats.lastSeen)}</span></div>
                    </div>
                    <h3 style="color:var(--text-light);margin-bottom:20px">Your Reminders</h3>
                    <div id="remindersList" style="text-align:left;max-width:500px;margin:0 auto">
                        ${userReminders.length === 0 ? '<p style="text-align:center;color:var(--text-gray)">No reminders set</p>' : userReminders.map(r => `
                            <div style="background:var(--graphite);padding:15px;border-radius:10px;margin-bottom:10px;border-left:4px solid var(--cyan)">
                                <div style="font-weight:600;margin-bottom:5px">${r.matchup}</div>
                                <div style="font-size:.9rem;color:var(--text-gray)">${r.competition}</div>
                                <div style="font-size:.8rem;color:var(--cyan);margin-top:5px">${formatTime(r.date_time)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top:30px">
                        <button class="watch-btn" onclick="restartUserSession()" style="background:var(--wine-red);color:#fff;">
                            <i class="fas fa-redo"></i> START NEW SESSION
                        </button>
                    </div>
                </div>
            `;
            accountView.style.display = 'block';
            setInterval(() => { 
                const el = document.getElementById('accountTimer'); 
                if (el) el.textContent = guestTimer.textContent; 
            }, 1000);
        }

        /* ----------  HELPERS  ---------- */
        function getTeamName(match, index) {
            if (match.team_logos && match.team_logos[index] && match.team_logos[index].team_name) return match.team_logos[index].team_name;
            if (match.matchup) {
                const parts = match.matchup.split(/[–\-]/);
                if (parts.length >= 2) return parts[index].trim();
            }
            return index === 0 ? 'Home Team' : 'Away Team';
        }
        
        function getTeamLogo(match, index) {
            if (match.team_logos && match.team_logos[index] && match.team_logos[index].logo_url) return match.team_logos[index].logo_url;
            return '';
        }
        
        function formatTime(dateTime) {
            if (!dateTime) return 'TBD';
            const d = new Date((d => d.setHours(d.getHours() - 1))(new Date(dateTime)) || dateTime);
            if (isNaN(d.getTime())) return dateTime;
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const matchDate = new Date(d.getFullYear(), d.getMonth(), d.getDate());
            const timeStr = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            if (matchDate.getTime() === today.getTime()) return `${timeStr} Today`;
            if (matchDate.getTime() === today.getTime() + 86400000) return `${timeStr} Tomorrow`;
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[d.getMonth()]} ${d.getDate()}, ${timeStr}`;
        }

        /* ----------  EVENT LISTENERS  ---------- */
        function setupEventListeners() {
            continueBtn.addEventListener('click', () => { 
                guestModal.style.display = 'none'; 
                loadData(); 
            });
            
            notificationClose.addEventListener('click', () => userSessionManager.hideNotification());
            backBtn.addEventListener('click', () => switchView('home'));
            refreshBtn.addEventListener('click', loadData);
            
            dockItems.forEach(item => item.addEventListener('click', function () { 
                switchView(this.dataset.view); 
            }));
            
            modalClose.addEventListener('click', closeModal);
            matchModal.addEventListener('click', e => { 
                if (e.target === matchModal) closeModal(); 
            });
            
            modalWatchBtn.addEventListener('click', watchNow);
            modalReminderBtn.addEventListener('click', toggleReminder);
            
            searchBtn.addEventListener('click', performSearch);
            searchBar.addEventListener('keyup', e => { 
                if (e.key === 'Enter') performSearch(); 
            });
            
            let searchTimeout;
            searchBar.addEventListener('input', () => { 
                clearTimeout(searchTimeout); 
                searchTimeout = setTimeout(performSearch, 300); 
            });
            
            // Session expired modal buttons
            restartSessionBtn.addEventListener('click', restartUserSession);
            closeExpiredModal.addEventListener('click', () => {
                userSessionManager.hideSessionExpiredModal();
            });
            
            // Auto-refresh data every 2 minutes if on live or home view
            setInterval(() => { 
                if (currentView === 'live' || currentView === 'home') loadData(); 
            }, 120000);
            
            // Update countdown timers
            setInterval(startCountdownTimers, 1000);
        }

        /* ----------  GLOBAL EXPORTS  ---------- */
        window.openPreview = openPreview;
        window.loadData = loadData;
        window.switchView = switchView;
        window.watchNow = watchNow;
        window.performSearch = performSearch;
        window.restartUserSession = restartUserSession;
        window.showNotification = userSessionManager ? userSessionManager.showNotification.bind(userSessionManager) : () => {};
        window.hideNotification = userSessionManager ? userSessionManager.hideNotification.bind(userSessionManager) : () => {};
    </script>
</body>
</html>
